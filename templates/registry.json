{
  "templates": {
    "close_case": {
      "description": "Close a case page with status and reason",
      "plan": {
        "kind": "ExecutionPlan",
        "execution_id": "{{execution_id}}",
        "threadId": "{{threadId}}",
        "dry_run": false,
        "goal": "Template: close_case",
        "agent_versions": { "validator": "1.2.0", "planner": "1.1.3" },
        "assumptions": ["Generated by local template registry"],
        "required_secrets": [
          { "name": "NOTION_TOKEN", "source": "env", "notes": "Notion API token for approval-scoped live writes" }
        ],
        "phases": [
          {
            "phase_id": "read",
            "required_capabilities": ["notion.read.page"],
            "steps": [
              {
                "step_id": "read-page",
                "action": "notion.live.read",
                "adapter": "WebhookAdapter",
                "method": "GET",
                "read_only": true,
                "url": "https://api.notion.com/v1/pages/{{page_id}}",
                "notion_path": "/v1/pages/{{page_id}}",
                "headers": { "Cache-Control": "no-store" },
                "expects": { "http_status": [200], "json_paths_present": ["id", "properties"] },
                "idempotency_key": null
              }
            ]
          },
          {
            "phase_id": "analyze",
            "required_capabilities": ["notion.read.page"],
            "inputs_from": ["read"],
            "steps": [
              {
                "step_id": "analyze-noop",
                "action": "noop",
                "adapter": "WebhookAdapter",
                "method": "GET",
                "read_only": true,
                "url": "http://localhost:8787/status/200",
                "headers": { "Cache-Control": "no-store" },
                "expects": { "http_status": [200] },
                "idempotency_key": null
              }
            ]
          },
          {
            "phase_id": "write",
            "required_capabilities": ["notion.write.page_property"],
            "inputs_from": ["read", "analyze"],
            "steps": [
              {
                "step_id": "write-status",
                "action": "notion.live.write",
                "adapter": "WebhookAdapter",
                "method": "PATCH",
                "read_only": false,
                "approval_scoped": true,
                "url": "https://api.notion.com/v1/pages/{{page_id}}",
                "notion_path": "/v1/pages/{{page_id}}",
                "notion_path_prestate": "/v1/pages/{{page_id}}",
                "properties": { "Status": { "rich_text": [ { "text": { "content": "{{status}}" } } ] } },
                "headers": { "Cache-Control": "no-store" },
                "expects": { "http_status": [200] },
                "idempotency_key": null
              },
              {
                "step_id": "write-reason",
                "action": "notion.live.write",
                "adapter": "WebhookAdapter",
                "method": "PATCH",
                "read_only": false,
                "approval_scoped": true,
                "url": "https://api.notion.com/v1/pages/{{page_id}}",
                "notion_path": "/v1/pages/{{page_id}}",
                "notion_path_prestate": "/v1/pages/{{page_id}}",
                "properties": { "Reason": { "rich_text": [ { "text": { "content": "{{reason}}" } } ] } },
                "headers": { "Cache-Control": "no-store" },
                "expects": { "http_status": [200] },
                "idempotency_key": null
              }
            ]
          }
        ]
      }
    },
    "tax_case_to_waiting_on_docs": {
      "description": "Set a tax case to Waiting on Docs and record missing docs",
      "plan": {
        "kind": "ExecutionPlan",
        "execution_id": "{{execution_id}}",
        "threadId": "{{threadId}}",
        "dry_run": false,
        "goal": "Template: tax_case_to_waiting_on_docs",
        "agent_versions": { "validator": "1.2.0", "planner": "1.1.3" },
        "assumptions": ["Generated by local template registry"],
        "required_secrets": [
          { "name": "NOTION_TOKEN", "source": "env", "notes": "Notion API token for approval-scoped live writes" }
        ],
        "phases": [
          {
            "phase_id": "read",
            "required_capabilities": ["notion.read.page"],
            "steps": [
              {
                "step_id": "read-page",
                "action": "notion.live.read",
                "adapter": "WebhookAdapter",
                "method": "GET",
                "read_only": true,
                "url": "https://api.notion.com/v1/pages/{{page_id}}",
                "notion_path": "/v1/pages/{{page_id}}",
                "headers": { "Cache-Control": "no-store" },
                "expects": { "http_status": [200], "json_paths_present": ["id", "properties"] },
                "idempotency_key": null
              }
            ]
          },
          {
            "phase_id": "analyze",
            "required_capabilities": ["notion.read.page"],
            "inputs_from": ["read"],
            "steps": [
              {
                "step_id": "analyze-noop",
                "action": "noop",
                "adapter": "WebhookAdapter",
                "method": "GET",
                "read_only": true,
                "url": "http://localhost:8787/status/200",
                "headers": { "Cache-Control": "no-store" },
                "expects": { "http_status": [200] },
                "idempotency_key": null
              }
            ]
          },
          {
            "phase_id": "write",
            "required_capabilities": ["notion.write.page_property"],
            "inputs_from": ["read", "analyze"],
            "steps": [
              {
                "step_id": "write-status",
                "action": "notion.live.write",
                "adapter": "WebhookAdapter",
                "method": "PATCH",
                "read_only": false,
                "approval_scoped": true,
                "url": "https://api.notion.com/v1/pages/{{page_id}}",
                "notion_path": "/v1/pages/{{page_id}}",
                "notion_path_prestate": "/v1/pages/{{page_id}}",
                "properties": { "Status": { "rich_text": [ { "text": { "content": "Waiting on Docs" } } ] } },
                "guards": [
                  { "path": "properties.Status.rich_text[0].text.content", "op": "!=", "value": "Filed" }
                ],
                "headers": { "Cache-Control": "no-store" },
                "expects": { "http_status": [200] },
                "idempotency_key": null
              },
              {
                "step_id": "write-metadata",
                "action": "notion.live.write",
                "adapter": "WebhookAdapter",
                "method": "PATCH",
                "read_only": false,
                "approval_scoped": true,
                "url": "https://api.notion.com/v1/pages/{{page_id}}",
                "notion_path": "/v1/pages/{{page_id}}",
                "notion_path_prestate": "/v1/pages/{{page_id}}",
                "properties": {
                  "Missing Docs": { "rich_text": [ { "text": { "content": "{{missing_docs}}" } } ] },
                  "Next Action": { "rich_text": [ { "text": { "content": "Send request" } } ] }
                },
                "headers": { "Cache-Control": "no-store" },
                "expects": { "http_status": [200] },
                "idempotency_key": null
              }
            ]
          }
        ]
      }
    },

    "tax_case_to_cpa_ready": {
      "description": "Set a tax case to CPA Ready with summary",
      "plan": {
        "kind": "ExecutionPlan",
        "execution_id": "{{execution_id}}",
        "threadId": "{{threadId}}",
        "dry_run": false,
        "goal": "Template: tax_case_to_cpa_ready",
        "agent_versions": { "validator": "1.2.0", "planner": "1.1.3" },
        "assumptions": ["Generated by local template registry"],
        "required_secrets": [
          { "name": "NOTION_TOKEN", "source": "env", "notes": "Notion API token for approval-scoped live writes" }
        ],
        "phases": [
          {
            "phase_id": "read",
            "required_capabilities": ["notion.read.page"],
            "steps": [
              {
                "step_id": "read-page",
                "action": "notion.live.read",
                "adapter": "WebhookAdapter",
                "method": "GET",
                "read_only": true,
                "url": "https://api.notion.com/v1/pages/{{page_id}}",
                "notion_path": "/v1/pages/{{page_id}}",
                "headers": { "Cache-Control": "no-store" },
                "expects": { "http_status": [200], "json_paths_present": ["id", "properties"] },
                "idempotency_key": null
              }
            ]
          },
          {
            "phase_id": "write",
            "required_capabilities": ["notion.write.page_property"],
            "inputs_from": ["read"],
            "steps": [
              {
                "step_id": "write-status",
                "action": "notion.live.write",
                "adapter": "WebhookAdapter",
                "method": "PATCH",
                "read_only": false,
                "approval_scoped": true,
                "url": "https://api.notion.com/v1/pages/{{page_id}}",
                "notion_path": "/v1/pages/{{page_id}}",
                "notion_path_prestate": "/v1/pages/{{page_id}}",
                "properties": { "Status": { "rich_text": [ { "text": { "content": "CPA Ready" } } ] } },
                "guards": [
                  { "path": "properties.Missing Docs.rich_text[0].text.content", "op": "==", "value": "" }
                ],
                "headers": { "Cache-Control": "no-store" },
                "expects": { "http_status": [200] },
                "idempotency_key": null
              },
              {
                "step_id": "write-summary",
                "action": "notion.live.write",
                "adapter": "WebhookAdapter",
                "method": "PATCH",
                "read_only": false,
                "approval_scoped": true,
                "url": "https://api.notion.com/v1/pages/{{page_id}}",
                "notion_path": "/v1/pages/{{page_id}}",
                "notion_path_prestate": "/v1/pages/{{page_id}}",
                "properties": {
                  "Agent Summary (CPA-Ready)": { "rich_text": [ { "text": { "content": "{{summary}}" } } ] },
                  "Professional Judgment Required?": { "rich_text": [ { "text": { "content": "{{professional_judgment_required}}" } } ] }
                },
                "headers": { "Cache-Control": "no-store" },
                "expects": { "http_status": [200] },
                "idempotency_key": null
              }
            ]
          }
        ]
      }
    },

    "document_intake_logged": {
      "description": "Record that document intake was logged and last review timestamp",
      "plan": {
        "kind": "ExecutionPlan",
        "execution_id": "{{execution_id}}",
        "threadId": "{{threadId}}",
        "dry_run": false,
        "goal": "Template: document_intake_logged",
        "agent_versions": { "validator": "1.2.0", "planner": "1.1.3" },
        "assumptions": ["Generated by local template registry"],
        "required_secrets": [
          { "name": "NOTION_TOKEN", "source": "env", "notes": "Notion API token for approval-scoped live writes" }
        ],
        "phases": [
          {
            "phase_id": "read",
            "required_capabilities": ["notion.read.page"],
            "steps": [
              {
                "step_id": "read-page",
                "action": "notion.live.read",
                "adapter": "WebhookAdapter",
                "method": "GET",
                "read_only": true,
                "url": "https://api.notion.com/v1/pages/{{page_id}}",
                "notion_path": "/v1/pages/{{page_id}}",
                "headers": { "Cache-Control": "no-store" },
                "expects": { "http_status": [200], "json_paths_present": ["id", "properties"] },
                "idempotency_key": null
              }
            ]
          },
          {
            "phase_id": "write",
            "required_capabilities": ["notion.write.page_property"],
            "inputs_from": ["read"],
            "steps": [
              {
                "step_id": "write-review",
                "action": "notion.live.write",
                "adapter": "WebhookAdapter",
                "method": "PATCH",
                "read_only": false,
                "approval_scoped": true,
                "url": "https://api.notion.com/v1/pages/{{page_id}}",
                "notion_path": "/v1/pages/{{page_id}}",
                "notion_path_prestate": "/v1/pages/{{page_id}}",
                "properties": {
                  "Last Agent Review": { "rich_text": [ { "text": { "content": "{{reviewed_at}}" } } ] }
                },
                "headers": { "Cache-Control": "no-store" },
                "expects": { "http_status": [200] },
                "idempotency_key": null
              },
              {
                "step_id": "write-status",
                "action": "notion.live.write",
                "adapter": "WebhookAdapter",
                "method": "PATCH",
                "read_only": false,
                "approval_scoped": true,
                "url": "https://api.notion.com/v1/pages/{{page_id}}",
                "notion_path": "/v1/pages/{{page_id}}",
                "notion_path_prestate": "/v1/pages/{{page_id}}",
                "properties": {
                  "Status": { "rich_text": [ { "text": { "content": "Docs Received" } } ] }
                },
                "headers": { "Cache-Control": "no-store" },
                "expects": { "http_status": [200] },
                "idempotency_key": null
              }
            ]
          }
        ]
      }
    }
  }
}