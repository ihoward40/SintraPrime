---
sidebar_position: 3
title: Immutable Receipt Ledger
description: How SintraPrime's cryptographic receipt system provides immutable audit trails with SHA-256 and Ed25519.
---

# Immutable Receipt Ledger

Every operation in SintraPrime — whether approved or denied — generates a **cryptographic receipt** that is chained to the previous receipt, creating an immutable, tamper-evident audit trail. This system is the backbone of SintraPrime's court-ready compliance.

## Receipt Structure

Each receipt contains the following fields:

```json
{
  "receipt_id": "rcpt_a1b2c3d4e5f6",
  "timestamp": "2026-02-20T15:30:00.000Z",
  "version": "2.0.0",
  "operation": {
    "type": "adapter.gmail.send",
    "agent": "general-purpose-agent",
    "task_id": "task_x7y8z9",
    "status": "completed",
    "duration_ms": 1250
  },
  "governance": {
    "mode": "SINGLE_RUN_APPROVED",
    "policy_gates_passed": ["spending_limit", "adapter_allowlist"],
    "approval": {
      "required": true,
      "approver": "operator@example.com",
      "approved_at": "2026-02-20T15:29:55.000Z"
    }
  },
  "chain": {
    "previous_hash": "sha256:a3f2b1c4d5e6f7...",
    "current_hash": "sha256:b4g3c2d1e0f9a8...",
    "sequence_number": 1547
  },
  "signature": {
    "algorithm": "Ed25519",
    "public_key": "ed25519:MCowBQYDK2VwAyEA...",
    "value": "base64:SGVsbG8gV29ybGQ..."
  },
  "metadata": {
    "input_summary": "Send email to user@example.com",
    "output_summary": "Email delivered successfully",
    "adapters_used": ["gmail"],
    "cost_usd": 0.002
  }
}
```

## SHA-256 Hash Chaining

Every receipt includes a hash of the previous receipt, creating an unbreakable chain:

```
Receipt N-2          Receipt N-1          Receipt N
┌──────────┐        ┌──────────┐        ┌──────────┐
│ hash: H1 │───────▶│ prev: H1 │───────▶│ prev: H2 │
│          │        │ hash: H2 │        │ hash: H3 │
└──────────┘        └──────────┘        └──────────┘
```

The hash is computed over the entire receipt content (excluding the current hash and signature fields):

```typescript
import { createHash } from 'crypto';

function computeReceiptHash(receipt: Receipt): string {
  const hashable = {
    receipt_id: receipt.receipt_id,
    timestamp: receipt.timestamp,
    operation: receipt.operation,
    governance: receipt.governance,
    chain: { previous_hash: receipt.chain.previous_hash },
    metadata: receipt.metadata,
  };
  return createHash('sha256')
    .update(JSON.stringify(hashable))
    .digest('hex');
}
```

:::warning Tamper Detection
If any receipt in the chain is modified, all subsequent hashes become invalid. This makes tampering immediately detectable during verification.
:::

## Ed25519 Digital Signatures

Each receipt is signed with an Ed25519 private key, providing:

- **Authenticity** — Proof that the receipt was generated by SintraPrime
- **Integrity** — Any modification invalidates the signature
- **Non-repudiation** — The signer cannot deny generating the receipt

Signing keys are stored in the `governance/keys/` directory:

```
governance/keys/
├── README.md           # Key management documentation
├── signing.key         # Private key (never committed to git)
└── signing.pub         # Public key (used for verification)
```

## Verification Process

To verify a receipt chain:

```bash
# Verify a single receipt
npx sintraprime receipt verify rcpt_a1b2c3d4e5f6

# Verify the entire chain
npx sintraprime receipt verify-chain

# Verify a specific range
npx sintraprime receipt verify-chain --from 1500 --to 1547
```

The verification process checks:

1. **Hash integrity** — Recompute the hash and compare
2. **Chain continuity** — Verify each receipt's `previous_hash` matches the prior receipt's `current_hash`
3. **Signature validity** — Verify the Ed25519 signature against the public key
4. **Sequence continuity** — Ensure no gaps in sequence numbers
5. **Timestamp ordering** — Verify chronological ordering

## Receipt Types

| Type | Generated When |
|:---|:---|
| `operation.completed` | An operation executes successfully |
| `operation.failed` | An operation fails during execution |
| `governance.denied` | A governance check rejects an operation |
| `governance.approved` | A human approves a pending operation |
| `mode.transition` | The governance mode changes |
| `policy.updated` | A policy gate configuration changes |
| `system.startup` | The system starts up |
| `system.shutdown` | The system shuts down gracefully |

## Storage and Retention

Receipts are stored in two locations:

- **File system** — JSON files in the `receipts/` directory, named by `receipt_id`
- **Database** — Indexed in MySQL for fast querying and reporting

Receipt files follow the naming convention:

```
receipts/
├── rcpt_a1b2c3d4e5f6.json
├── rcpt_b2c3d4e5f6a1.json
└── ...
```

:::info Retention Policy
Receipts are **never deleted**. The immutable nature of the receipt chain means that removing any receipt would break the chain integrity. For long-term archival, receipts can be exported and stored in external systems.
:::

## Next Steps

- [Governance Model](./governance-model) — How governance decisions are made
- [Agent Mode Engine](./agent-mode-engine) — How receipts integrate with execution
- [Evidence Lifecycle](../evidence-systems/lifecycle) — How receipts feed into evidence systems
