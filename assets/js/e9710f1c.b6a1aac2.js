"use strict";(globalThis.webpackChunksintraprime_docs=globalThis.webpackChunksintraprime_docs||[]).push([[6763],{8279(e,n,t){t.r(n),t.d(n,{assets:()=>d,contentTitle:()=>a,default:()=>h,frontMatter:()=>c,metadata:()=>i,toc:()=>l});const i=JSON.parse('{"id":"core-concepts/receipt-ledger","title":"Immutable Receipt Ledger","description":"How SintraPrime\'s cryptographic receipt system provides immutable audit trails with SHA-256 and Ed25519.","source":"@site/docs/core-concepts/receipt-ledger.md","sourceDirName":"core-concepts","slug":"/core-concepts/receipt-ledger","permalink":"/SintraPrime/docs/core-concepts/receipt-ledger","draft":false,"unlisted":false,"editUrl":"https://github.com/ihoward40/SintraPrime/tree/gh-pages-source/docs/core-concepts/receipt-ledger.md","tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"sidebar_position":3,"title":"Immutable Receipt Ledger","description":"How SintraPrime\'s cryptographic receipt system provides immutable audit trails with SHA-256 and Ed25519."},"sidebar":"docsSidebar","previous":{"title":"Governance Model","permalink":"/SintraPrime/docs/core-concepts/governance-model"},"next":{"title":"Agent Mode Engine","permalink":"/SintraPrime/docs/core-concepts/agent-mode-engine"}}');var r=t(4848),s=t(8453);const c={sidebar_position:3,title:"Immutable Receipt Ledger",description:"How SintraPrime's cryptographic receipt system provides immutable audit trails with SHA-256 and Ed25519."},a="Immutable Receipt Ledger",d={},l=[{value:"Receipt Structure",id:"receipt-structure",level:2},{value:"SHA-256 Hash Chaining",id:"sha-256-hash-chaining",level:2},{value:"Ed25519 Digital Signatures",id:"ed25519-digital-signatures",level:2},{value:"Verification Process",id:"verification-process",level:2},{value:"Receipt Types",id:"receipt-types",level:2},{value:"Storage and Retention",id:"storage-and-retention",level:2},{value:"Next Steps",id:"next-steps",level:2}];function o(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"immutable-receipt-ledger",children:"Immutable Receipt Ledger"})}),"\n",(0,r.jsxs)(n.p,{children:["Every operation in SintraPrime \u2014 whether approved or denied \u2014 generates a ",(0,r.jsx)(n.strong,{children:"cryptographic receipt"})," that is chained to the previous receipt, creating an immutable, tamper-evident audit trail. This system is the backbone of SintraPrime's court-ready compliance."]}),"\n",(0,r.jsx)(n.h2,{id:"receipt-structure",children:"Receipt Structure"}),"\n",(0,r.jsx)(n.p,{children:"Each receipt contains the following fields:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "receipt_id": "rcpt_a1b2c3d4e5f6",\n  "timestamp": "2026-02-20T15:30:00.000Z",\n  "version": "2.0.0",\n  "operation": {\n    "type": "adapter.gmail.send",\n    "agent": "general-purpose-agent",\n    "task_id": "task_x7y8z9",\n    "status": "completed",\n    "duration_ms": 1250\n  },\n  "governance": {\n    "mode": "SINGLE_RUN_APPROVED",\n    "policy_gates_passed": ["spending_limit", "adapter_allowlist"],\n    "approval": {\n      "required": true,\n      "approver": "operator@example.com",\n      "approved_at": "2026-02-20T15:29:55.000Z"\n    }\n  },\n  "chain": {\n    "previous_hash": "sha256:a3f2b1c4d5e6f7...",\n    "current_hash": "sha256:b4g3c2d1e0f9a8...",\n    "sequence_number": 1547\n  },\n  "signature": {\n    "algorithm": "Ed25519",\n    "public_key": "ed25519:MCowBQYDK2VwAyEA...",\n    "value": "base64:SGVsbG8gV29ybGQ..."\n  },\n  "metadata": {\n    "input_summary": "Send email to user@example.com",\n    "output_summary": "Email delivered successfully",\n    "adapters_used": ["gmail"],\n    "cost_usd": 0.002\n  }\n}\n'})}),"\n",(0,r.jsx)(n.h2,{id:"sha-256-hash-chaining",children:"SHA-256 Hash Chaining"}),"\n",(0,r.jsx)(n.p,{children:"Every receipt includes a hash of the previous receipt, creating an unbreakable chain:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"Receipt N-2          Receipt N-1          Receipt N\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510        \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510        \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 hash: H1 \u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25b6\u2502 prev: H1 \u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25b6\u2502 prev: H2 \u2502\n\u2502          \u2502        \u2502 hash: H2 \u2502        \u2502 hash: H3 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518        \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518        \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,r.jsx)(n.p,{children:"The hash is computed over the entire receipt content (excluding the current hash and signature fields):"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"import { createHash } from 'crypto';\n\nfunction computeReceiptHash(receipt: Receipt): string {\n  const hashable = {\n    receipt_id: receipt.receipt_id,\n    timestamp: receipt.timestamp,\n    operation: receipt.operation,\n    governance: receipt.governance,\n    chain: { previous_hash: receipt.chain.previous_hash },\n    metadata: receipt.metadata,\n  };\n  return createHash('sha256')\n    .update(JSON.stringify(hashable))\n    .digest('hex');\n}\n"})}),"\n",(0,r.jsx)(n.admonition,{title:"Tamper Detection",type:"warning",children:(0,r.jsx)(n.p,{children:"If any receipt in the chain is modified, all subsequent hashes become invalid. This makes tampering immediately detectable during verification."})}),"\n",(0,r.jsx)(n.h2,{id:"ed25519-digital-signatures",children:"Ed25519 Digital Signatures"}),"\n",(0,r.jsx)(n.p,{children:"Each receipt is signed with an Ed25519 private key, providing:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Authenticity"})," \u2014 Proof that the receipt was generated by SintraPrime"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Integrity"})," \u2014 Any modification invalidates the signature"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Non-repudiation"})," \u2014 The signer cannot deny generating the receipt"]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["Signing keys are stored in the ",(0,r.jsx)(n.code,{children:"governance/keys/"})," directory:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"governance/keys/\n\u251c\u2500\u2500 README.md           # Key management documentation\n\u251c\u2500\u2500 signing.key         # Private key (never committed to git)\n\u2514\u2500\u2500 signing.pub         # Public key (used for verification)\n"})}),"\n",(0,r.jsx)(n.h2,{id:"verification-process",children:"Verification Process"}),"\n",(0,r.jsx)(n.p,{children:"To verify a receipt chain:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Verify a single receipt\nnpx sintraprime receipt verify rcpt_a1b2c3d4e5f6\n\n# Verify the entire chain\nnpx sintraprime receipt verify-chain\n\n# Verify a specific range\nnpx sintraprime receipt verify-chain --from 1500 --to 1547\n"})}),"\n",(0,r.jsx)(n.p,{children:"The verification process checks:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Hash integrity"})," \u2014 Recompute the hash and compare"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Chain continuity"})," \u2014 Verify each receipt's ",(0,r.jsx)(n.code,{children:"previous_hash"})," matches the prior receipt's ",(0,r.jsx)(n.code,{children:"current_hash"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Signature validity"})," \u2014 Verify the Ed25519 signature against the public key"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Sequence continuity"})," \u2014 Ensure no gaps in sequence numbers"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Timestamp ordering"})," \u2014 Verify chronological ordering"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"receipt-types",children:"Receipt Types"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{style:{textAlign:"left"},children:"Type"}),(0,r.jsx)(n.th,{style:{textAlign:"left"},children:"Generated When"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{style:{textAlign:"left"},children:(0,r.jsx)(n.code,{children:"operation.completed"})}),(0,r.jsx)(n.td,{style:{textAlign:"left"},children:"An operation executes successfully"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{style:{textAlign:"left"},children:(0,r.jsx)(n.code,{children:"operation.failed"})}),(0,r.jsx)(n.td,{style:{textAlign:"left"},children:"An operation fails during execution"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{style:{textAlign:"left"},children:(0,r.jsx)(n.code,{children:"governance.denied"})}),(0,r.jsx)(n.td,{style:{textAlign:"left"},children:"A governance check rejects an operation"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{style:{textAlign:"left"},children:(0,r.jsx)(n.code,{children:"governance.approved"})}),(0,r.jsx)(n.td,{style:{textAlign:"left"},children:"A human approves a pending operation"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{style:{textAlign:"left"},children:(0,r.jsx)(n.code,{children:"mode.transition"})}),(0,r.jsx)(n.td,{style:{textAlign:"left"},children:"The governance mode changes"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{style:{textAlign:"left"},children:(0,r.jsx)(n.code,{children:"policy.updated"})}),(0,r.jsx)(n.td,{style:{textAlign:"left"},children:"A policy gate configuration changes"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{style:{textAlign:"left"},children:(0,r.jsx)(n.code,{children:"system.startup"})}),(0,r.jsx)(n.td,{style:{textAlign:"left"},children:"The system starts up"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{style:{textAlign:"left"},children:(0,r.jsx)(n.code,{children:"system.shutdown"})}),(0,r.jsx)(n.td,{style:{textAlign:"left"},children:"The system shuts down gracefully"})]})]})]}),"\n",(0,r.jsx)(n.h2,{id:"storage-and-retention",children:"Storage and Retention"}),"\n",(0,r.jsx)(n.p,{children:"Receipts are stored in two locations:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"File system"})," \u2014 JSON files in the ",(0,r.jsx)(n.code,{children:"receipts/"})," directory, named by ",(0,r.jsx)(n.code,{children:"receipt_id"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Database"})," \u2014 Indexed in MySQL for fast querying and reporting"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Receipt files follow the naming convention:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"receipts/\n\u251c\u2500\u2500 rcpt_a1b2c3d4e5f6.json\n\u251c\u2500\u2500 rcpt_b2c3d4e5f6a1.json\n\u2514\u2500\u2500 ...\n"})}),"\n",(0,r.jsx)(n.admonition,{title:"Retention Policy",type:"info",children:(0,r.jsxs)(n.p,{children:["Receipts are ",(0,r.jsx)(n.strong,{children:"never deleted"}),". The immutable nature of the receipt chain means that removing any receipt would break the chain integrity. For long-term archival, receipts can be exported and stored in external systems."]})}),"\n",(0,r.jsx)(n.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"./governance-model",children:"Governance Model"})," \u2014 How governance decisions are made"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"./agent-mode-engine",children:"Agent Mode Engine"})," \u2014 How receipts integrate with execution"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"../evidence-systems/lifecycle",children:"Evidence Lifecycle"})," \u2014 How receipts feed into evidence systems"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(o,{...e})}):o(e)}},8453(e,n,t){t.d(n,{R:()=>c,x:()=>a});var i=t(6540);const r={},s=i.createContext(r);function c(e){const n=i.useContext(s);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:c(e.components),i.createElement(s.Provider,{value:n},e.children)}}}]);