[
  {
    "name": "tier24-2-court-export-happy",
    "stage": "cli",
    "env": {
      "SMOKE_FIXED_NOW_ISO": "2025-12-25T00:00:00Z",
      "NOTION_RUNS_WEBHOOK": null,
      "PERSIST_LOCAL_RECEIPTS": "1"
    },
    "fixture_write": [
      {
        "path": "runs/governance/latest.json",
        "json": {
          "kind": "GovernanceSnapshot",
          "registry_version": "fixture",
          "capability": "fixture",
          "confidence": 1,
          "timestamp": "2025-12-25T00:00:00Z",
          "note": "fixture"
        }
      },
      {
        "path": "runs/policy-explain/latest.json",
        "json": {
          "kind": "PolicyExplainLatest",
          "generated_at": "2025-12-25T00:00:00Z",
          "note": "fixture"
        }
      },
      {
        "path": "runs/policy-sim/latest.json",
        "json": {
          "kind": "PolicySimLatest",
          "generated_at": "2025-12-25T00:00:00Z",
          "note": "fixture"
        }
      },
      {
        "path": "runs/confidence/latest.json",
        "json": {
          "kind": "ConfidenceLatest",
          "fingerprint": "fixture",
          "last_confidence": 1,
          "last_updated_at": "2025-12-25T00:00:00Z",
          "monotonic_ok": true,
          "regressions": 0,
          "last_regression_at": null,
          "last_regression_delta": null
        }
      }
    ],
    "command": "/operator court-export --capability notion.write.page_property --as-of latest --format pdf --seal",
    "expect_exit_code": 0,
    "expect": {
      "kind": "CourtExport",
      "ok": true,
      "export_id": "court_export_2025-12-25T00-00-00Z"
    },
    "expect_file_exists": "runs/court-export/court_export_2025-12-25T00-00-00Z/MANIFEST.json",
    "post_assert": {
      "receipt_subset": {
        "execution_id": "court_export_2025-12-25T00-00-00Z",
        "status": "success",
        "kind": "CourtExportReceipt"
      }
    }
  },
  {
    "name": "tier24-2-court-export-deny-missing-latest",
    "stage": "cli",
    "env": {
      "SMOKE_FIXED_NOW_ISO": "2025-12-25T00:10:00Z",
      "NOTION_RUNS_WEBHOOK": null,
      "PERSIST_LOCAL_RECEIPTS": "1"
    },
    "fixture_write": [
      {
        "path": "runs/policy-explain/latest.json",
        "json": {
          "kind": "PolicyExplainLatest",
          "generated_at": "2025-12-25T00:10:00Z",
          "note": "fixture"
        }
      }
    ],
    "command": "/operator court-export --capability notion.write.page_property --as-of latest --format pdf --seal",
    "expect_exit_code": 3,
    "expect": {
      "kind": "PolicyDenied",
      "code": "COURT_EXPORT_MISSING_LATEST",
      "export_id": "court_export_2025-12-25T00-10-00Z"
    },
    "expect_file_exists": "runs/court-export/court_export_2025-12-25T00-10-00Z/DENIAL.json",
    "post_assert": {
      "receipt_subset": {
        "execution_id": "court_export_2025-12-25T00-10-00Z",
        "status": "denied",
        "kind": "CourtExportReceipt"
      }
    }
  },
  {
    "name": "tier16-confidence-monotonic-ok",
    "stage": "cli",
    "env": {
      "SMOKE_FIXED_NOW_ISO": "2025-12-25T01:00:00Z",
      "REQUALIFICATION_ENABLED": "1"
    },
    "command": "/confidence record notion.write.page_property 0.70",
    "expect_exit_code": 0,
    "expect": {
      "kind": "ConfidenceRecorded",
      "fingerprint": "notion.write.page_property",
      "regression": false,
      "monotonic_ok": true
    },
    "post_assert": {
      "artifact_dir": "runs/confidence",
      "contains_subset": {
        "kind": "ConfidenceLatest",
        "fingerprint": "notion.write.page_property",
        "monotonic_ok": true
      }
    }
  },
  {
    "name": "tier16-confidence-regression-suspends",
    "stage": "cli",
    "env": {
      "SMOKE_FIXED_NOW_ISO": "2025-12-25T01:10:00Z",
      "REQUALIFICATION_ENABLED": "1"
    },
    "fixture_write": [
      {
        "path": "runs/confidence/latest.json",
        "json": {
          "kind": "ConfidenceLatest",
          "fingerprint": "notion.write.page_property",
          "last_confidence": 0.9,
          "last_updated_at": "2025-12-25T01:09:00Z",
          "monotonic_ok": true,
          "regressions": 0,
          "last_regression_at": null,
          "last_regression_delta": null
        }
      }
    ],
    "command": "/confidence record notion.write.page_property 0.75",
    "expect_exit_code": 0,
    "expect": {
      "kind": "ConfidenceRecorded",
      "fingerprint": "notion.write.page_property",
      "regression": true,
      "monotonic_ok": false
    },
    "post_assert": {
      "artifact_dir": "runs/requalification/state",
      "contains_subset": {
        "fingerprint": "notion.write.page_property",
        "state": "SUSPENDED",
        "cause": "CONFIDENCE_REGRESSION"
      }
    }
  },
  {
    "name": "tier22_3-activate-eligible",
    "stage": "cli",
    "env": {
      "REQUALIFICATION_ENABLED": "1",
      "SMOKE_FIXED_NOW_ISO": "2025-01-01T12:00:00Z"
    },
    "fixture_write": [
      {
        "path": "runs/requalification/state/notion.write.page.json",
        "json": {
          "fingerprint": "notion.write.page",
          "state": "ELIGIBLE",
          "cause": "PROBATION_SUCCESS",
          "since": "2025-12-25T00:00:00Z"
        }
      }
    ],
    "cmd": "/autonomy requalify activate notion.write.page",
    "expect_exit_code": 0,
    "expect_subset_json": {
      "kind": "RequalificationActivated",
      "fingerprint": "notion.write.page",
      "state": "ACTIVE"
    },
    "expect_file_exists": "runs/requalification/events/notion.write.page.activate.1735732800000.json",
    "post_assert": {
      "artifact_dir": "runs/requalification/state",
      "contains_keys": ["state"],
      "contains_subset": { "fingerprint": "notion.write.page", "state": "ACTIVE" }
    }
  },
  {
    "name": "tier22_3-deny-non-eligible",
    "stage": "cli",
    "env": {
      "REQUALIFICATION_ENABLED": "1",
      "SMOKE_FIXED_NOW_ISO": "2025-01-01T12:00:00Z"
    },
    "fixture_write": [
      {
        "path": "runs/requalification/state/notion.write.page.json",
        "json": {
          "fingerprint": "notion.write.page",
          "state": "PROBATION",
          "cause": "POLICY_DENIAL",
          "since": "2025-12-25T00:00:00Z"
        }
      }
    ],
    "cmd": "/autonomy requalify activate notion.write.page",
    "expect_exit_code": 3,
    "expect_subset_json": {
      "kind": "PolicyDenied",
      "code": "REQUIRES_ELIGIBLE_STATE"
    }
  },
  {
    "name": "tier23_22_3-activation-deny-low-confidence",
    "stage": "cli",
    "env": {
      "RUNS_DIR": "runs",
      "REQUALIFICATION_ENABLED": "1",
      "SMOKE_FIXED_NOW_ISO": "2025-01-01T12:00:00Z",
      "SINTRA_NOW_ISO": "2025-01-01T12:00:00Z",
      "AUTONOMY_ACTIVATE_MIN_CONFIDENCE": "0.80",
      "CONFIDENCE_HALF_LIFE_HOURS": "72",
      "CONFIDENCE_MIN": "0"
    },
    "fixture_write": [
      {
        "path": "runs/requalification/state/notion.write.page.json",
        "json": {
          "fingerprint": "notion.write.page",
          "state": "ELIGIBLE",
          "cause": "PROBATION_SUCCESS",
          "since": "2025-12-25T00:00:00Z"
        }
      },
      {
        "path": "runs/confidence/notion.write.page.json",
        "json": {
          "fingerprint": "notion.write.page",
          "raw_confidence": 0.79,
          "updated_at": "2025-01-01T12:00:00Z"
        }
      }
    ],
    "cmd": "/autonomy requalify activate notion.write.page",
    "expect_exit_code": 3,
    "expect_subset_json": {
      "kind": "PolicyDenied",
      "code": "ACTIVATION_CONFIDENCE_TOO_LOW",
      "fingerprint": "notion.write.page",
      "required_min_confidence": 0.8
    }
  },
  {
    "name": "tier23_22_3-activation-touches-confidence",
    "stage": "cli",
    "env": {
      "RUNS_DIR": "runs",
      "REQUALIFICATION_ENABLED": "1",
      "SMOKE_FIXED_NOW_ISO": "2025-01-01T12:00:00Z",
      "SINTRA_NOW_ISO": "2025-01-01T12:00:00Z",
      "AUTONOMY_ACTIVATE_MIN_CONFIDENCE": "0.80",
      "CONFIDENCE_HALF_LIFE_HOURS": "72",
      "CONFIDENCE_MIN": "0"
    },
    "fixture_write": [
      {
        "path": "runs/requalification/state/notion.write.page.json",
        "json": {
          "fingerprint": "notion.write.page",
          "state": "ELIGIBLE",
          "cause": "PROBATION_SUCCESS",
          "since": "2025-12-25T00:00:00Z"
        }
      },
      {
        "path": "runs/confidence/notion.write.page.json",
        "json": {
          "kind": "ConfidenceArtifact",
          "fingerprint": "notion.write.page",
          "confidence": 0.9,
          "updated_at": "2025-01-01T00:00:00Z",
          "signals": []
        }
      }
    ],
    "cmd": "/autonomy requalify activate notion.write.page",
    "expect_exit_code": 0,
    "expect_subset_json": {
      "kind": "RequalificationActivated",
      "fingerprint": "notion.write.page",
      "state": "ACTIVE"
    },
    "post_assert": {
      "artifact_dir": "runs/confidence",
      "contains_keys": ["updated_at"],
      "contains_subset": {
        "fingerprint": "notion.write.page",
        "updated_at": "2025-01-01T12:00:00Z"
      }
    }
  },
  {
    "name": "tier23-decay-math-deterministic",
    "stage": "cli",
    "env": {
      "RUNS_DIR": "runs",
      "SINTRA_NOW_ISO": "2025-01-01T12:00:00Z",
      "CONFIDENCE_HALF_LIFE_HOURS": "1",
      "CONFIDENCE_MIN": "0"
    },
    "fixture_write": [
      {
        "path": "runs/confidence/notion.write.page.json",
        "json": {
          "fingerprint": "notion.write.page",
          "raw_confidence": 1,
          "updated_at": "2025-01-01T11:00:00Z"
        }
      }
    ],
    "command": "/operator confidence peek notion.write.page",
    "expect_exit_code": 0,
    "expect": {
      "kind": "ConfidencePeek",
      "fingerprint": "notion.write.page",
      "raw_confidence": 1,
      "decayed_confidence": 0.5,
      "age_ms": 3600000,
      "updated_at": "2025-01-01T11:00:00Z"
    }
  },
  {
    "name": "governance-golden-pack",
    "stage": "cli",
    "env": {
      "SMOKE_FIXED_NOW_ISO": "2025-12-25T00:00:00Z"
    },
    "fixture_write": [
      {
        "path": "runs/governance/latest.json",
        "json": {
          "registry_version": "1",
          "capability": "notion.write.page",
          "confidence": 0.9,
          "timestamp": "2025-12-25T00:00:00Z",
          "note": "fixture"
        }
      }
    ],
    "cmd": "/governance golden-pack",
    "expect_subset_json": {
      "kind": "GovernanceGoldenPack",
      "verified": true
    }
  },
  {
    "name": "tier23-low-confidence-triggers-downgrade",
    "stage": "cli",
    "env": {
      "RUNS_DIR": "runs",
      "REQUALIFICATION_ENABLED": "1",
      "SINTRA_NOW_ISO": "2025-01-01T12:00:00Z",
      "AUTONOMY_MIN_CONFIDENCE": "0.60",
      "CONFIDENCE_HALF_LIFE_HOURS": "72",
      "CONFIDENCE_MIN": "0"
    },
    "fixture_write": [
      {
        "path": "runs/requalification/state/916b8ac414809fd92c7b0ed199abf76d064487029c55321c6d3af39fa5b7fe60.json",
        "json": {
          "fingerprint": "916b8ac414809fd92c7b0ed199abf76d064487029c55321c6d3af39fa5b7fe60",
          "state": "ACTIVE",
          "cause": "OPERATOR_ACTIVATED",
          "since": "2025-01-01T00:00:00Z"
        }
      },
      {
        "path": "runs/confidence/916b8ac414809fd92c7b0ed199abf76d064487029c55321c6d3af39fa5b7fe60.json",
        "json": {
          "fingerprint": "916b8ac414809fd92c7b0ed199abf76d064487029c55321c6d3af39fa5b7fe60",
          "raw_confidence": 0.59,
          "updated_at": "2025-01-01T12:00:00Z"
        }
      }
    ],
    "command": "/tier23 ping",
    "expect_exit_code": 4,
    "expect": {
      "kind": "ConfidenceDecayed",
      "fingerprint": "916b8ac414809fd92c7b0ed199abf76d064487029c55321c6d3af39fa5b7fe60",
      "from": "ACTIVE",
      "to": "PROBATION"
    },
    "expect_file_exists": "runs/confidence/events/916b8ac414809fd92c7b0ed199abf76d064487029c55321c6d3af39fa5b7fe60.decay.1735732800000.json",
    "post_assert": {
      "artifact_dir": "runs/requalification/state",
      "contains_keys": ["state"],
      "contains_subset": { "fingerprint": "916b8ac414809fd92c7b0ed199abf76d064487029c55321c6d3af39fa5b7fe60", "state": "PROBATION", "cause": "CONFIDENCE_DECAY" }
    }
  },
  {
    "name": "tier22_1-probation-success-to-eligible",
    "stage": "cli",
    "env": {
      "SINTRA_NOW_ISO": "2025-01-01T00:00:00Z",
      "REQUALIFICATION_ENABLED": "1",
      "PROBATION_MIN_SUCCESSES": "2",
      "PROBATION_MAX_CONFIDENCE_DROP": "0.00",
      "CONFIDENCE_HALF_LIFE_HOURS": "72",
      "CONFIDENCE_MIN": "0",
      "ALLOWED_DOMAINS": null,
      "ALLOWED_METHODS": null,
      "ENVIRONMENT": null,
      "NODE_ENV": null,
      "CONFIRM_PROD": null,
      "NOTION_API_BASE": "http://localhost:8787",
      "NOTION_API_VERSION": "2022-06-28",
      "NOTION_TOKEN": "local_mock_token",
      "NOTION_REDACT_KEYS": "title,name"
    },
    "fixture_write": [
      {
        "path": "runs/requalification/state/notion.write.page.json",
        "json": {
          "fingerprint": "notion.write.page",
          "state": "PROBATION",
          "cause": "MANUAL_TEST",
          "since": "2025-01-01T00:00:00Z",
          "cooldown_until": null
        }
      },
      {
        "path": "runs/requalification/counters/notion.write.page.json",
        "json": {
          "fingerprint": "notion.write.page",
          "successes": 1,
          "last_confidence": 0,
          "last_updated": "2025-01-01T00:00:00Z"
        }
      }
    ],
    "cmd": "/notion live db db_001",
    "expect": {
      "status": "success"
    },
    "post_assert": {
      "artifact_dir": "runs/requalification/state",
      "contains_subset": { "fingerprint": "notion.write.page", "state": "ELIGIBLE" }
    }
  },
  {
    "name": "tier22_1-probation-reset-on-drop",
    "stage": "cli",
    "fixture_write": [
      {
        "path": "runs/requalification/state/notion.write.page.json",
        "json": {
          "fingerprint": "notion.write.page",
          "state": "PROBATION",
          "cause": "MANUAL_TEST",
          "since": "2025-01-01T00:00:00Z",
          "cooldown_until": null
        }
      },
      {
        "path": "runs/requalification/counters/notion.write.page.json",
        "json": {
          "fingerprint": "notion.write.page",
          "successes": 1,
          "last_confidence": 2,
          "last_updated": "2025-01-01T00:00:00Z"
        }
      }
    ],
    "env": {
      "SINTRA_NOW_ISO": "2025-01-01T00:00:00Z",
      "REQUALIFICATION_ENABLED": "1",
      "PROBATION_MIN_SUCCESSES": "2",
      "PROBATION_MAX_CONFIDENCE_DROP": "0.00",
      "CONFIDENCE_HALF_LIFE_HOURS": "72",
      "CONFIDENCE_MIN": "0",
      "ALLOWED_DOMAINS": null,
      "ALLOWED_METHODS": null,
      "ENVIRONMENT": null,
      "NODE_ENV": null,
      "CONFIRM_PROD": null,
      "NOTION_API_BASE": "http://localhost:8787",
      "NOTION_API_VERSION": "2022-06-28",
      "NOTION_TOKEN": "local_mock_token",
      "NOTION_REDACT_KEYS": "title,name"
    },
    "cmd": "/notion live db db_001",
    "expect": {
      "status": "success"
    },
    "post_assert": {
      "artifact_dir": "runs/requalification/counters",
      "contains_subset": { "fingerprint": "notion.write.page", "successes": 0 }
    }
  },
  {
    "name": "tier15-domain-not-allowlisted",
    "stage": "cli",
    "command": "/notion live read db_001",
    "env": {
      "ALLOWED_DOMAINS": "example.com",
      "ALLOWED_METHODS": null,
      "ENVIRONMENT": null,
      "NODE_ENV": null,
      "CONFIRM_PROD": null,
      "NOTION_API_BASE": "http://localhost:8787",
      "NOTION_API_VERSION": "2022-06-28",
      "NOTION_TOKEN": "local_mock_token"
    },
    "expect_exit_code": 3,
    "expect": {
      "kind": "PolicyDenied",
      "code": "DOMAIN_NOT_ALLOWED"
    },
    "post_assert": {
      "explain_trace": {
        "checks": [
          {
            "check_id": "DOMAIN_ALLOWLIST",
            "result": "FAIL"
          }
        ]
      }
    }
  },
  {
    "name": "build-validation-live",
    "stage": "planner",
    "command": "/build validation-agent {\"dry_run\":false}",
    "expect": {
      "kind": "ExecutionPlan"
    }
  },
  {
    "name": "unknown-command",
    "stage": "validation",
    "command": "/build does-not-exist",
    "expect": {
      "kind": "ValidatedCommand",
      "allowed": false
    }
  },
  {
    "name": "document-intake-dsl",
    "stage": "planner",
    "command": "/intake ./docs",
    "expect": {
      "kind": "ExecutionPlan"
    }
  },
  {
    "name": "document-intake-canonical",
    "stage": "planner",
    "command": "/build document-intake {\"path\":\"./docs\"}",
    "expect": {
      "kind": "ExecutionPlan"
    }
  },
  {
    "name": "document-intake-missing-path",
    "stage": "validation",
    "command": "/build document-intake {}",
    "expect": {
      "kind": "NeedInput"
    }
  },
  {
    "name": "document-intake-artifact-written",
    "stage": "cli",
    "command": "/intake ./docs",
    "env": {
      "ALLOWED_DOMAINS": null,
      "ALLOWED_METHODS": null,
      "command": "/template run close_case {\"page_id\":\"pg_001\",\"status\":\"Closed\",\"reason\":\"Docs received\"}",
      "NODE_ENV": null,
      "CONFIRM_PROD": null
    },
    "expect": {
      "status": "success"
    },
    "post_assert": {
      "artifact_dir": "runs/intake",
      "contains_keys": [
        "files",
        "path"
      ]
    }
  },
  {
    "name": "capability-resolves-intake-scan",
    "stage": "cli",
    "command": "/intake ./docs",
    "env": {
      "ALLOWED_DOMAINS": null,
      "ALLOWED_METHODS": null,
      "ENVIRONMENT": null,
      "NODE_ENV": null,
      "CONFIRM_PROD": null
    },
    "expect": {
      "status": "success"
    },
    "post_assert": {
      "receipt_subset": {
        "status": "success",
        "resolved_capabilities": {
          "intake.scan": "document-intake-agent@1.0.0"
        }
      }
    }
  },
  {
    "name": "phases-happy-path",
    "stage": "cli",
    "command": "/intake ./docs",
    "planner_override": {
      "kind": "ExecutionPlan",
      "execution_id": "exec_mock_phases_happy_001",
      "threadId": "local_test_001",
      "dry_run": false,
      "goal": "Tier-5.2 phased happy path",
      "agent_versions": {
        "validator": "1.2.0",
        "planner": "1.1.3"
      },
      "assumptions": [
        "Generated by test-only planner override"
      ],
      "required_secrets": [],
      "phases": [
        {
          "phase_id": "intake",
          "required_capabilities": [
            "intake.scan"
          ],
          "steps": [
            {
              "step_id": "scan-path",
              "action": "scan_documents",
              "adapter": "WebhookAdapter",
              "method": "POST",
              "url": "http://localhost:8787/intake/scan",
              "payload": {
                "path": "./docs"
              },
              "expects": {
                "http_status": 200
              },
              "idempotency_key": null
            }
          ],
          "outputs": [
            "files",
            "path"
          ]
        },
        {
          "phase_id": "analysis",
          "required_capabilities": [
            "tax.analyze"
          ],
          "inputs_from": [
            "intake"
          ],
          "steps": [
            {
              "step_id": "analyze-files",
              "action": "tax_analyze",
              "adapter": "WebhookAdapter",
              "method": "POST",
              "url": "http://localhost:8787/tax/analyze",
              "expects": {
                "http_status": 200
              },
              "idempotency_key": null
            }
          ]
        }
      ]
    },
    "expect": {
      "status": "success"
    },
    "post_assert": {
      "receipt_subset": {
        "status": "success",
        "phases_planned": [
          "intake",
          "analysis"
        ],
        "phases_executed": [
          "intake",
          "analysis"
        ],
        "resolved_capabilities": {
          "intake.scan": "document-intake-agent@1.0.0",
          "tax.analyze": "tax-agent@1.0.0"
        }
      }
    }
  },
  {
    "name": "phases-missing-capability",
    "stage": "cli",
    "command": "/intake ./docs",
    "planner_override": {
      "kind": "ExecutionPlan",
      "execution_id": "exec_mock_phases_missing_cap_001",
      "threadId": "local_test_001",
      "dry_run": false,
      "goal": "Tier-5.2 missing capability",
      "agent_versions": {
        "validator": "1.2.0",
        "planner": "1.1.3"
      },
      "assumptions": [
        "Generated by test-only planner override"
      ],
      "required_secrets": [],
      "phases": [
        {
          "phase_id": "intake",
          "required_capabilities": [
            "intake.scan"
          ],
          "steps": [
            {
              "step_id": "scan-path",
              "action": "scan_documents",
              "adapter": "WebhookAdapter",
              "method": "POST",
              "url": "http://localhost:8787/intake/scan",
              "payload": {
                "path": "./docs"
              },
              "expects": {
                "http_status": 200
              },
              "idempotency_key": null
            }
          ],
          "outputs": [
            "files",
            "path"
          ]
        },
        {
          "phase_id": "analysis",
          "required_capabilities": [
            "capability.does.not.exist"
          ],
          "inputs_from": [
            "intake"
          ],
          "steps": [
            {
              "step_id": "analyze-files",
              "action": "tax_analyze",
              "adapter": "WebhookAdapter",
              "method": "POST",
              "url": "http://localhost:8787/tax/analyze",
              "expects": {
                "http_status": 200
              },
              "idempotency_key": null
            }
          ]
        }
      ]
    },
    "expect_exit_code": 3,
    "expect": {
      "kind": "PolicyDenied"
    },
    "post_assert": {
      "receipt_subset": {
        "status": "denied",
        "denied_phase": "analysis",
        "phases_planned": [
          "intake",
          "analysis"
        ],
        "phases_executed": [
          "intake"
        ],
        "policy_denied": {
          "code": "POLICY_CAPABILITY_UNRESOLVED"
        }
      }
    }
  },
  {
    "name": "phases-ordering-violation",
    "stage": "cli",
    "command": "/intake ./docs",
    "planner_override": {
      "kind": "ExecutionPlan",
      "execution_id": "exec_mock_phases_ordering_001",
      "threadId": "local_test_001",
      "dry_run": false,
      "goal": "Tier-5.2 ordering violation",
      "agent_versions": {
        "validator": "1.2.0",
        "planner": "1.1.3"
      },
      "assumptions": [
        "Generated by test-only planner override"
      ],
      "required_secrets": [],
      "phases": [
        {
          "phase_id": "analysis",
          "required_capabilities": [
            "tax.analyze"
          ],
          "inputs_from": [
            "intake"
          ],
          "steps": [
            {
              "step_id": "analyze-files",
              "action": "tax_analyze",
              "adapter": "WebhookAdapter",
              "method": "POST",
              "url": "http://localhost:8787/tax/analyze",
              "expects": {
                "http_status": 200
              },
              "idempotency_key": null
            }
          ]
        },
        {
          "phase_id": "intake",
          "required_capabilities": [
            "intake.scan"
          ],
          "steps": [
            {
              "step_id": "scan-path",
              "action": "scan_documents",
              "adapter": "WebhookAdapter",
              "method": "POST",
              "url": "http://localhost:8787/intake/scan",
              "payload": {
                "path": "./docs"
              },
              "expects": {
                "http_status": 200
              },
              "idempotency_key": null
            }
          ],
          "outputs": [
            "files",
            "path"
          ]
        }
      ]
    },
    "expect_exit_code": 1,
    "expect": {
      "kind": "CliError",
      "code": "CLI_PHASES_INVALID"
    }
  },
  {
    "name": "phases-invalid-forward-reference",
    "stage": "cli",
    "command": "/intake ./docs",
    "planner_override": {
      "kind": "ExecutionPlan",
      "execution_id": "exec_mock_phases_invalid_forward_ref_001",
      "threadId": "local_test_001",
      "dry_run": false,
      "goal": "Tier-5.2 invalid forward reference",
      "agent_versions": {
        "validator": "1.2.0",
        "planner": "1.1.3"
      },
      "assumptions": [
        "Generated by test-only planner override"
      ],
      "required_secrets": [],
      "phases": [
        {
          "phase_id": "analysis",
          "required_capabilities": [
            "tax.analyze"
          ],
          "inputs_from": [
            "intake"
          ],
          "steps": [
            {
              "step_id": "noop-analysis",
              "action": "noop",
              "adapter": "WebhookAdapter",
              "method": "GET",
              "url": "http://localhost:8787/status/200",
              "expects": {
                "http_status": 200
              },
              "idempotency_key": null
            }
          ]
        },
        {
          "phase_id": "intake",
          "required_capabilities": [
            "intake.scan"
          ],
          "steps": [
            {
              "step_id": "noop-intake",
              "action": "noop",
              "adapter": "WebhookAdapter",
              "method": "GET",
              "url": "http://localhost:8787/status/200",
              "expects": {
                "http_status": 200
              },
              "idempotency_key": null
            }
          ]
        }
      ]
    },
    "expect_exit_code": 1,
    "expect": {
      "kind": "CliError",
      "code": "CLI_PHASES_INVALID"
    }
  },
  {
    "name": "policy-deny-domain",
    "stage": "cli",
    "command": "/build anything {\"noop\":true}",
    "env": {
      "THREAD_ID": "local_test_001",
      "ALLOWED_DOMAINS": "good.example.com"
    },
    "planner_override": {
      "kind": "ExecutionPlan",
      "execution_id": "policy_deny_domain_001",
      "threadId": "local_test_001",
      "dry_run": true,
      "goal": "Trigger domain allowlist policy denial",
      "agent_versions": {
        "validator": "1.2.0",
        "planner": "1.1.3"
      },
      "required_secrets": [],
      "steps": [
        {
          "step_id": "domain-check",
          "action": "ping",
          "adapter": "WebhookAdapter",
          "method": "GET",
          "url": "https://evil.example.com/ping",
          "expects": {
            "http_status": [
              200
            ]
          },
          "idempotency_key": null
        }
      ]
    },
    "expect_exit_code": 3,
    "expect": {
      "kind": "PolicyDenied",
      "code": "DOMAIN_NOT_ALLOWED"
    },
    "post_assert": {
      "receipt_subset": {
        "status": "denied",
        "policy_denied": {
          "code": "DOMAIN_NOT_ALLOWED"
        }
      }
    }
  },
  {
    "name": "policy-deny-prod-write",
    "stage": "cli",
    "command": "/build anything {\"noop\":true}",
    "env": {
      "THREAD_ID": "local_test_001",
      "ENVIRONMENT": "production",
      "CONFIRM_PROD": null,
      "ALLOWED_DOMAINS": null,
      "ALLOWED_METHODS": null
    },
    "planner_override": {
      "kind": "ExecutionPlan",
      "execution_id": "policy_deny_prod_write_001",
      "threadId": "local_test_001",
      "dry_run": false,
      "goal": "Trigger production write approval requirement",
      "agent_versions": {
        "validator": "1.2.0",
        "planner": "1.1.3"
      },
      "required_secrets": [],
      "steps": [
        {
          "step_id": "prod-write",
          "action": "write",
          "adapter": "WebhookAdapter",
          "method": "POST",
          "url": "http://localhost:8787/intake/scan",
          "payload": {
            "path": "./docs"
          },
          "expects": {
            "http_status": [
              200
            ]
          },
          "idempotency_key": null
        }
      ]
    },
    "expect_exit_code": 4,
    "expect": {
      "kind": "ApprovalRequired",
      "code": "WRITE_OPERATION"
    },
    "post_assert": {
      "receipt_subset": {
        "status": "awaiting_approval",
        "approval_required": {
          "kind": "ApprovalRequired",
          "code": "WRITE_OPERATION"
        }
      },
      "approval_state": true
    }
  },
  {
    "name": "approval-resume-prod-write",
    "stage": "cli",
    "command": "/approve policy_deny_prod_write_001",
    "env": {
      "ENVIRONMENT": "production"
    },
    "expect_exit_code": 0,
    "expect": {
      "status": "success"
    },
    "post_assert": {
      "receipt_subset": {
        "status": "success",
        "execution_id": "policy_deny_prod_write_001"
      },
      "resume_reused_plan_hash": true
    }
  },
  {
    "name": "notion-read-database-mock",
    "stage": "cli",
    "command": "/notion db db_mock_001",
    "env": {
      "ALLOWED_DOMAINS": null,
      "ALLOWED_METHODS": null,
      "ENVIRONMENT": null,
      "NODE_ENV": null,
      "CONFIRM_PROD": null
    },
    "expect_file_exists": "runs/notion/exec_mock_notion_db_001.read-database.json",
    "expect": {
      "status": "success"
    },
    "post_assert": {
      "artifact_dir": "runs/notion",
      "contains_keys": [
        "properties",
        "id"
      ]
    }
  },
  {
    "name": "notion-read-page-mock",
    "stage": "cli",
    "command": "/notion page pg_mock_001",
    "env": {
      "ALLOWED_DOMAINS": null,
      "ALLOWED_METHODS": null,
      "ENVIRONMENT": null,
      "NODE_ENV": null,
      "CONFIRM_PROD": null
    },
    "expect_file_exists": "runs/notion/exec_mock_notion_page_001.read-page.json",
    "expect": {
      "status": "success"
    },
    "post_assert": {
      "artifact_dir": "runs/notion",
      "contains_keys": [
        "properties",
        "id"
      ]
    }
  },
  {
    "name": "notion-read-deny-non-get",
    "stage": "cli",
    "command": "/notion db db_mock_001",
    "env": {
      "THREAD_ID": "local_test_001",
      "ALLOWED_DOMAINS": null,
      "ALLOWED_METHODS": null,
      "ENVIRONMENT": null,
      "NODE_ENV": null,
      "CONFIRM_PROD": null
    },
    "planner_override": {
      "kind": "ExecutionPlan",
      "execution_id": "exec_mock_notion_read_deny_001",
      "threadId": "local_test_001",
      "dry_run": false,
      "goal": "Policy test: Notion read steps must be GET/HEAD",
      "agent_versions": {
        "validator": "1.2.0",
        "planner": "1.1.3"
      },
      "required_secrets": [],
      "steps": [
        {
          "step_id": "read-database-illegal-method",
          "action": "notion.read.database",
          "adapter": "NotionAdapter",
          "method": "PATCH",
          "read_only": true,
          "url": "http://localhost:8787/notion/database/db_mock_001",
          "headers": {
            "Cache-Control": "no-store"
          },
          "expects": {
            "http_status": [
              200
            ]
          },
          "idempotency_key": null
        }
      ]
    },
    "expect_exit_code": 3,
    "expect": {
      "kind": "PolicyDenied",
      "code": "METHOD_NOT_ALLOWED"
    }
  },
  {
    "name": "notion-write-approval-required",
    "stage": "cli",
    "command": "/notion set pg_001 Status=Done",
    "env": {
      "ALLOWED_DOMAINS": null,
      "ALLOWED_METHODS": null,
      "ENVIRONMENT": null,
      "NODE_ENV": null,
      "CONFIRM_PROD": null
    },
    "expect_exit_code": 4,
    "expect": {
      "kind": "ApprovalRequired",
      "code": "NOTION_WRITE_APPROVAL_REQUIRED"
    },
    "post_assert": {
      "approval_state": true
    }
  },
  {
    "name": "notion-write-approved",
    "stage": "cli",
    "command": "/approve exec_mock_notion_write_001",
    "env": {
      "ALLOWED_DOMAINS": null,
      "ALLOWED_METHODS": null,
      "ENVIRONMENT": null,
      "NODE_ENV": null,
      "CONFIRM_PROD": null
    },
    "expect_exit_code": 0,
    "expect": {
      "status": "success",
      "execution_id": "exec_mock_notion_write_001"
    },
    "expect_file_exists": "runs/notion-write/exec_mock_notion_write_001.write-page-property.json",
    "post_assert": {
      "artifact_dir": "runs/notion-write",
      "contains_keys": [
        "request_payload",
        "response",
        "action",
        "execution_id",
        "approved_at"
      ],
      "contains_subset": {
        "response": {
          "updated": true
        }
      }
    }
  },
  {
    "name": "notion-title-write-pauses",
    "stage": "cli",
    "command": "/notion title pg_001 \"New Title\"",
    "expect": {
      "kind": "ApprovalRequired"
    },
    "expect_exit_code": 4,
    "post_assert": {
      "approval_state": true
    }
  },
  {
    "name": "notion-title-write-approve-resumes",
    "stage": "cli",
    "command": "/approve exec_mock_notion_title_001",
    "post_assert": {
      "artifact_dir": "runs/notion-write",
      "contains_keys": [
        "updated",
        "title"
      ]
    }
  },
  {
    "name": "tier7-orchestration-pauses-at-write",
    "stage": "cli",
    "command": "/orchestrate notion-status db_001 pg_001",
    "expect": {
      "kind": "ApprovalRequired"
    },
    "expect_exit_code": 4,
    "post_assert": {
      "approval_state": true
    }
  },
  {
    "name": "tier7-orchestration-approve-completes",
    "stage": "cli",
    "command": "/approve exec_mock_orchestration_001",
    "post_assert": {
      "artifact_dir": "runs/notion",
      "contains_keys": [
        "properties"
      ]
    }
  },
  {
    "name": "tier8-read-only-autonomy-happy",
    "stage": "cli",
    "env": {
      "AUTONOMY_MODE": "READ_ONLY_AUTONOMY"
    },
    "command": "/notion db db_001",
    "expect": {
      "status": "success"
    },
    "post_assert": {
      "artifact_dir": "runs/autonomy",
      "contains_keys": [
        "execution_id",
        "mode"
      ]
    }
  },
  {
    "name": "tier8-read-only-autonomy-write-denied",
    "stage": "cli",
    "env": {
      "AUTONOMY_MODE": "READ_ONLY_AUTONOMY"
    },
    "command": "/notion set pg_001 Status=Done",
    "expect": {
      "kind": "PolicyDenied",
      "code": "AUTONOMY_READ_ONLY_VIOLATION"
    },
    "expect_exit_code": 3
  },
  {
    "name": "tier9-prestate-written-on-approval",
    "stage": "cli",
    "command": "/notion set pg_001 Status=Done",
    "expect": {
      "kind": "ApprovalRequired"
    },
    "expect_exit_code": 4,
    "post_assert": {
      "artifact_dir": "runs/prestate",
      "contains_keys": [
        "execution_id",
        "plan_hash",
        "snapshot"
      ]
    }
  },
  {
    "name": "tier9-rollback-recorded",
    "stage": "cli",
    "command": "/rollback policy_deny_prod_write_001",
    "expect": {
      "kind": "RollbackRecorded"
    },
    "post_assert": {
      "artifact_dir": "runs/rollback",
      "contains_keys": [
        "compensation_plan",
        "rolled_back_execution_id"
      ]
    }
  },
  {
    "name": "tier10-notion-live-read-redacted",
    "stage": "cli",
    "command": "/notion live db db_001",
    "env": {
      "ALLOWED_DOMAINS": null,
      "ALLOWED_METHODS": null,
      "ENVIRONMENT": null,
      "NODE_ENV": null,
      "CONFIRM_PROD": null,
      "NOTION_API_BASE": "http://localhost:8787",
      "NOTION_API_VERSION": "2022-06-28",
      "NOTION_TOKEN": "local_mock_token",
      "NOTION_REDACT_KEYS": "title,name"
    },
    "expect": {
      "status": "success"
    },
    "post_assert": {
      "artifact_dir": "runs/notion-live-read",
      "contains_keys": [
        "execution_id",
        "step_id",
        "notion_path",
        "http_status",
        "response"
      ],
      "contains_subset": {
        "response": {
          "title": "[REDACTED]",
          "name": "[REDACTED]"
        }
      }
    }
  },
  {
    "name": "tier10-notion-live-write-denied",
    "stage": "cli",
    "command": "/notion live write db_001",
    "env": {
      "ALLOWED_DOMAINS": null,
      "ALLOWED_METHODS": null,
      "ENVIRONMENT": null,
      "NODE_ENV": null,
      "CONFIRM_PROD": null,
      "NOTION_API_BASE": "http://localhost:8787",
      "NOTION_API_VERSION": "2022-06-28",
      "NOTION_TOKEN": "local_mock_token",
      "NOTION_REDACT_KEYS": "title,name"
    },
    "expect_exit_code": 3,
    "expect": {
      "kind": "PolicyDenied",
      "code": "NOTION_LIVE_REQUIRES_READ_ONLY"
    }
  },
  {
    "name": "tier10_2-live-write-pauses",
    "stage": "cli",
    "command": "/notion live set pg_001 Status=Done",
    "env": {
      "ALLOWED_DOMAINS": null,
      "ALLOWED_METHODS": null,
      "ENVIRONMENT": null,
      "NODE_ENV": null,
      "CONFIRM_PROD": null,
      "NOTION_API_BASE": "http://localhost:8787",
      "NOTION_API_VERSION": "2022-06-28",
      "NOTION_TOKEN": "local_mock_token",
      "NOTION_REDACT_KEYS": "title,name",
      "NOTION_LIVE_APPROVE_RECHECK": "1"
    },
    "expect": {
      "kind": "ApprovalRequired"
    },
    "expect_exit_code": 4,
    "post_assert": {
      "artifact_dir": "runs/prestate",
      "contains_keys": [
        "execution_id",
        "snapshot"
      ]
    }
  },
  {
    "name": "tier10_2-approve-resumes-and-writes-artifact",
    "stage": "cli",
    "command": "/approve tier10_2-live-write-pauses_001",
    "env": {
      "ALLOWED_DOMAINS": null,
      "ALLOWED_METHODS": null,
      "ENVIRONMENT": null,
      "NODE_ENV": null,
      "CONFIRM_PROD": null,
      "NOTION_API_BASE": "http://localhost:8787",
      "NOTION_API_VERSION": "2022-06-28",
      "NOTION_TOKEN": "local_mock_token",
      "NOTION_REDACT_KEYS": "title,name",
      "NOTION_LIVE_APPROVE_RECHECK": "1"
    },
    "expect": {
      "status": "success"
    },
    "post_assert": {
      "artifact_dir": "runs/notion-live-write",
      "contains_keys": [
        "request_properties",
        "approved_at",
        "response"
      ]
    }
  },
  {
    "name": "tier10_3-bundle-pauses",
    "stage": "cli",
    "command": "/notion live set pg_001 Status=Done Priority=High",
    "env": {
      "ALLOWED_DOMAINS": null,
      "ALLOWED_METHODS": null,
      "ENVIRONMENT": null,
      "NODE_ENV": null,
      "CONFIRM_PROD": null,
      "NOTION_API_BASE": "http://localhost:8787",
      "NOTION_API_VERSION": "2022-06-28",
      "NOTION_TOKEN": "local_mock_token",
      "NOTION_REDACT_KEYS": "title,name",
      "NOTION_LIVE_APPROVE_RECHECK": "1"
    },
    "expect": {
      "kind": "ApprovalRequired"
    },
    "expect_exit_code": 4,
    "post_assert": {
      "artifact_dir": "runs/prestate",
      "contains_keys": [
        "execution_id",
        "snapshot"
      ]
    }
  },
  {
    "name": "tier10_3-bundle-approve-resumes-and-writes-artifact",
    "stage": "cli",
    "command": "/approve tier10_3-bundle-pauses_001",
    "env": {
      "ALLOWED_DOMAINS": null,
      "ALLOWED_METHODS": null,
      "ENVIRONMENT": null,
      "NODE_ENV": null,
      "CONFIRM_PROD": null,
      "NOTION_API_BASE": "http://localhost:8787",
      "NOTION_API_VERSION": "2022-06-28",
      "NOTION_TOKEN": "local_mock_token",
      "NOTION_REDACT_KEYS": "title,name",
      "NOTION_LIVE_APPROVE_RECHECK": "1"
    },
    "expect": {
      "status": "success"
    },
    "post_assert": {
      "artifact_dir": "runs/notion-live-write",
      "contains_keys": [
        "request_properties",
        "bundle_keys",
        "approved_at",
        "response"
      ]
    }
  },
  {
    "name": "tier10_4-guard-pauses",
    "stage": "cli",
    "command": "/notion live set pg_001 Status=Done --if Status!=Done",
    "env": {
      "ALLOWED_DOMAINS": null,
      "ALLOWED_METHODS": null,
      "ENVIRONMENT": null,
      "NODE_ENV": null,
      "CONFIRM_PROD": null,
      "NOTION_API_BASE": "http://localhost:8787",
      "NOTION_API_VERSION": "2022-06-28",
      "NOTION_TOKEN": "local_mock_token",
      "NOTION_REDACT_KEYS": "title,name",
      "NOTION_LIVE_APPROVE_RECHECK": "1"
    },
    "expect": {
      "kind": "ApprovalRequired"
    },
    "expect_exit_code": 4
  },
  {
    "name": "tier10_4-guard-fails-on-resume",
    "stage": "cli",
    "command": "/approve tier10_4-guard-pauses_001",
    "env": {
      "ALLOWED_DOMAINS": null,
      "ALLOWED_METHODS": null,
      "ENVIRONMENT": null,
      "NODE_ENV": null,
      "CONFIRM_PROD": null,
      "NOTION_API_BASE": "http://localhost:8787",
      "NOTION_API_VERSION": "2022-06-28",
      "NOTION_TOKEN": "local_mock_token",
      "NOTION_REDACT_KEYS": "title,name",
      "NOTION_LIVE_APPROVE_RECHECK": "1"
    },
    "expect": {
      "kind": "NeedApprovalAgain",
      "code": "GUARD_FAILED_PRE_EXEC"
    },
    "expect_exit_code": 4
  },
  {
    "name": "tier10_5-idempotency-hit-simple",
    "stage": "cli",
    "command": "/approve tier10_2-live-write-pauses_001",
    "env": {
      "ALLOWED_DOMAINS": null,
      "ALLOWED_METHODS": null,
      "ENVIRONMENT": null,
      "NODE_ENV": null,
      "CONFIRM_PROD": null,
      "NOTION_API_BASE": "http://localhost:8787",
      "NOTION_API_VERSION": "2022-06-28",
      "NOTION_TOKEN": "local_mock_token",
      "NOTION_REDACT_KEYS": "title,name",
      "NOTION_LIVE_APPROVE_RECHECK": "1"
    },
    "expect": {
      "kind": "AlreadyExecuted",
      "code": "IDEMPOTENCY_HIT"
    }
  },
  {
    "name": "tier10_5-idempotency-hit-bundle",
    "stage": "cli",
    "command": "/approve tier10_3-bundle-pauses_001",
    "env": {
      "ALLOWED_DOMAINS": null,
      "ALLOWED_METHODS": null,
      "ENVIRONMENT": null,
      "NODE_ENV": null,
      "CONFIRM_PROD": null,
      "NOTION_API_BASE": "http://localhost:8787",
      "NOTION_API_VERSION": "2022-06-28",
      "NOTION_TOKEN": "local_mock_token",
      "NOTION_REDACT_KEYS": "title,name",
      "NOTION_LIVE_APPROVE_RECHECK": "1"
    },
    "expect": {
      "kind": "AlreadyExecuted",
      "code": "IDEMPOTENCY_HIT"
    }
  },
  {
    "name": "tier10_6-batch-pauses-once",
    "stage": "cli",
    "command": "/notion live bundle pg_001 Status=Done Priority=High Owner=Isiah",
    "env": {
      "ALLOWED_DOMAINS": null,
      "ALLOWED_METHODS": null,
      "ENVIRONMENT": null,
      "NODE_ENV": null,
      "CONFIRM_PROD": null,
      "NOTION_API_BASE": "http://localhost:8787",
      "NOTION_API_VERSION": "2022-06-28",
      "NOTION_TOKEN": "local_mock_token",
      "NOTION_REDACT_KEYS": "title,name",
      "NOTION_LIVE_APPROVE_RECHECK": "1"
    },
    "expect": {
      "kind": "ApprovalRequiredBatch"
    },
    "expect_exit_code": 4,
    "post_assert": {
      "artifact_dir": "runs/approvals",
      "contains_keys": [
        "pending_step_ids",
        "plan_hash",
        "status"
      ]
    }
  },
  {
    "name": "tier10_6-approve-executes-all",
    "stage": "cli",
    "command": "/approve tier10_6-batch-pauses-once_001",
    "env": {
      "ALLOWED_DOMAINS": null,
      "ALLOWED_METHODS": null,
      "ENVIRONMENT": null,
      "NODE_ENV": null,
      "CONFIRM_PROD": null,
      "NOTION_API_BASE": "http://localhost:8787",
      "NOTION_API_VERSION": "2022-06-28",
      "NOTION_TOKEN": "local_mock_token",
      "NOTION_REDACT_KEYS": "title,name",
      "NOTION_LIVE_APPROVE_RECHECK": "1"
    },
    "expect": {
      "kind": "BatchApprovedExecuted"
    },
    "post_assert": {
      "artifact_dir": "runs/notion-live-write",
      "contains_keys": [
        "approved_at",
        "request_properties"
      ]
    }
  },
  {
    "name": "tier10_7-template-run-pauses-once",
    "stage": "cli",
    "command": "/template run close_case {\"page_id\":\"pg_001\",\"status\":\"Closed\",\"reason\":\"Docs received\"}",
    "env": {
      "ALLOWED_DOMAINS": null,
      "ALLOWED_METHODS": null,
      "ENVIRONMENT": null,
      "NODE_ENV": null,
      "CONFIRM_PROD": null,
      "NOTION_API_BASE": "http://localhost:8787",
      "NOTION_API_VERSION": "2022-06-28",
      "NOTION_TOKEN": "local_mock_token",
      "NOTION_REDACT_KEYS": "title,name",
      "NOTION_LIVE_APPROVE_RECHECK": "1"
    },
    "expect": {
      "kind": "ApprovalRequiredBatch"
    },
    "expect_exit_code": 4,
    "post_assert": {
      "artifact_dir": "runs/approvals",
      "contains_keys": [
        "pending_step_ids",
        "plan_hash",
        "status"
      ]
    }
  },
  {
    "name": "tier10_7-template-run-approve-executes-batch",
    "stage": "cli",
    "command": "/approve tier10_7-template-run-close_case_pg_001",
    "env": {
      "ALLOWED_DOMAINS": null,
      "ALLOWED_METHODS": null,
      "ENVIRONMENT": null,
      "NODE_ENV": null,
      "CONFIRM_PROD": null,
      "NOTION_API_BASE": "http://localhost:8787",
      "NOTION_API_VERSION": "2022-06-28",
      "NOTION_TOKEN": "local_mock_token",
      "NOTION_REDACT_KEYS": "title,name",
      "NOTION_LIVE_APPROVE_RECHECK": "1"
    },
    "expect": {
      "kind": "BatchApprovedExecuted"
    },
    "post_assert": {
      "artifact_dir": "runs/notion-live-write",
      "contains_keys": [
        "approved_at",
        "request_properties"
      ]
    }
  },
  {
    "name": "tier11-queue-list",
    "stage": "cli",
    "command": "/queue list",
    "expect": {
      "kind": "QueueList"
    }
  },
  {
    "name": "tier11-reject-run",
    "stage": "cli",
    "command": "/queue reject exec_123 \"Docs incomplete\"",
    "expect": {
      "kind": "RunRejected",
      "execution_id": "exec_123"
    }
  },
  {
    "name": "tier12-run-show",
    "stage": "cli",
    "command": "/run show exec_123",
    "expect": {
      "kind": "RunDetails"
    }
  },
  {
    "name": "tier12-run-artifacts",
    "stage": "cli",
    "command": "/run artifacts exec_123",
    "expect": {
      "kind": "ArtifactIndex"
    }
  },
  {
    "name": "tier13-explain-blocked-by-dedup",
    "stage": "cli",
    "command": "/scheduler explain notion_tax_cases_daily_scan --at 2024-01-08T09:15:30Z",
    "expect": {
      "kind": "SchedulerExplain",
      "job_id": "notion_tax_cases_daily_scan",
      "would_run": false,
      "decision": "BLOCKED",
      "primary_reason": "DEDUP_ACTIVE"
    },
    "post_assert": {
      "scheduler_explain": {
        "job_id": "notion_tax_cases_daily_scan",
        "at": "2024-01-08T09:15:30Z",
        "reset_history": true,
        "seed_dedup": true,
        "seed_budget_days": [
          {
            "day": "2024-01-08",
            "count": 0
          }
        ],
        "primary_reason": "DEDUP_ACTIVE",
        "would_run": false
      }
    }
  },
  {
    "name": "tier13-explain-eligible-after-budget-reset",
    "stage": "cli",
    "command": "/scheduler explain notion_tax_cases_daily_scan --at 2024-01-10T09:15:30Z",
    "expect": {
      "kind": "SchedulerExplain",
      "job_id": "notion_tax_cases_daily_scan",
      "would_run": true,
      "decision": "ELIGIBLE",
      "primary_reason": "ELIGIBLE"
    },
    "post_assert": {
      "scheduler_explain": {
        "job_id": "notion_tax_cases_daily_scan",
        "at": "2024-01-10T09:15:30Z",
        "reset_history": true,
        "seed_budget_days": [
          {
            "day": "2024-01-09",
            "count": 3
          }
        ],
        "primary_reason": "ELIGIBLE",
        "would_run": true
      }
    }
  },
  {
    "name": "tier13_5-scheduler-explain-not-found",
    "stage": "cli",
    "command": "/scheduler explain job_missing_001",
    "expect_exit_code": 2,
    "expect": {
      "kind": "SchedulerExplain",
      "query": "job_missing_001",
      "found": false
    }
  },
  {
    "name": "tier13_5-scheduler-explain-found-latest",
    "stage": "cli",
    "fixture_write": [
      {
        "path": "runs/scheduler/latest/job_001.json",
        "json": {
          "kind": "SchedulerDecision",
          "decision": "SKIPPED_DEDUP",
          "job_id": "job_001",
          "execution_id": "exec_seed_001",
          "dedup_hit": true,
          "dedup_key": "seeded",
          "decided_at": "2025-12-26T00:00:00Z"
        }
      }
    ],
    "command": "/scheduler explain job_001",
    "expect": {
      "kind": "SchedulerExplain",
      "query": "job_001",
      "found": true,
      "decision_record": {
        "kind": "SchedulerDecision",
        "decision": "SKIPPED_DEDUP",
        "job_id": "job_001",
        "execution_id": "exec_seed_001",
        "dedup_hit": true
      }
    }
  },
  {
    "name": "tier14-policy-simulate-require-approval",
    "stage": "cli",
    "command": "/policy sim /notion set pg_001 Status=Done",
    "expect_exit_code": 0,
    "expect": {
      "kind": "PolicySimulation",
      "decision": "REQUIRE_APPROVAL",
      "denial_code": "NOTION_WRITE_APPROVAL_REQUIRED",
      "approval_required": true
    },
    "post_assert": {
      "no_writes": {
        "paths": [
          "runs/receipts.jsonl",
          "runs/approvals",
          "runs/autonomy/state",
          "runs/scheduler",
          "runs/scheduler-history"
        ]
      }
    }
  },
  {
    "name": "tier14-policy-simulate-throttle",
    "stage": "cli",
    "command": "/policy sim /notion db db_001",
    "env": {
      "RUN_GOVERNOR_ENABLED": "1",
      "SMOKE_FIXED_NOW_ISO": "2024-01-10T09:15:30Z",
      "AUTONOMY_TOKENS_PER_HOUR": "1"
    },
    "precondition": {
      "governor_counter": {
        "command": "/notion db db_001",
        "hour_start": "2024-01-10T09:00:00.000Z",
        "tokens_remaining": 0,
        "concurrent": 0,
        "updated_at": "2024-01-10T09:15:30Z"
      }
    },
    "expect_exit_code": 0,
    "expect": {
      "kind": "PolicySimulation",
      "decision": "THROTTLE",
      "governor": {
        "decision": "DELAY"
      }
    },
    "post_assert": {
      "no_writes": {
        "paths": [
          "runs/receipts.jsonl",
          "runs/approvals",
          "runs/autonomy/state",
          "runs/scheduler",
          "runs/scheduler-history",
          "runs/governor/counters",
          "runs/governor/circuit-breakers"
        ]
      }
    }
  },
  {
    "name": "tier15-policy-explain-known",
    "stage": "cli",
    "command": "/policy explain NOTION_LIVE_REQUIRES_READ_ONLY",
    "expect_exit_code": 0,
    "expect": {
      "kind": "PolicyExplain",
      "code": "NOTION_LIVE_REQUIRES_READ_ONLY",
      "severity": "deny"
    },
    "post_assert": {
      "no_writes": {
        "paths": [
          "runs/receipts.jsonl",
          "runs/approvals",
          "runs/autonomy/state",
          "runs/scheduler",
          "runs/scheduler-history"
        ]
      }
    }
  },
  {
    "name": "tier15-policy-explain-unknown",
    "stage": "cli",
    "command": "/policy explain DOES_NOT_EXIST",
    "expect_exit_code": 0,
    "expect": {
      "kind": "PolicyExplain",
      "code": "DOES_NOT_EXIST",
      "title": "Unknown policy code"
    },
    "post_assert": {
      "no_writes": {
        "paths": [
          "runs/receipts.jsonl",
          "runs/approvals",
          "runs/autonomy/state",
          "runs/scheduler",
          "runs/scheduler-history"
        ]
      }
    }
  },
  {
    "name": "tier15-policy-variant-flip-spoken",
    "stage": "cli",
    "command": "/policy simulate-variants notion.write.page --confidence 0.3,0.95",
    "env": {
      "SPEECH_ENABLED": "1",
      "SPEECH_SINKS": "console",
      "SPEECH_CATEGORIES": "policy"
    },
    "expect": {
      "kind": "PolicySimulationVariants",
      "fingerprint": "notion.write.page"
    },
    "post_assert": {
      "stderr_contains": [
        "Policy regression detected at confidence 0.95"
      ]
    }
  },
  {
    "name": "tier15-policy-variant-no-change",
    "stage": "cli",
    "command": "/policy simulate-variants notion.write.page --confidence 0.2,0.3",
    "expect": {
      "kind": "PolicySimulationVariants",
      "fingerprint": "notion.write.page"
    }
  },
  {
    "name": "tier15-speech-delta-first",
    "stage": "cli",
    "command": "/speak confidence 0.95 Tier15 delta test",
    "env": {
      "SMOKE_FIXED_NOW_ISO": "2025-12-22T00:00:00.000Z",
      "THREAD_ID": "tier15_delta_001",
      "SPEECH_ENABLED": "1",
      "SPEECH_SINKS": "console",
      "SPEECH_DEBUG": "1",
      "SPEECH_DELTA_ONLY": "1",
      "SPEECH_DELTA_PERSIST": "1",
      "SPEECH_DELTA_TTL_MS": "86400000"
    },
    "expect": {
      "kind": "Spoke",
      "category": "confidence",
      "threadId": "tier15_delta_001"
    }
  },
  {
    "name": "tier15-speech-delta-repeat-suppressed",
    "stage": "cli",
    "command": "/speak confidence 0.95 Tier15 delta test",
    "env": {
      "SMOKE_FIXED_NOW_ISO": "2025-12-22T00:00:00.000Z",
      "THREAD_ID": "tier15_delta_001",
      "SPEECH_ENABLED": "1",
      "SPEECH_SINKS": "console",
      "SPEECH_DEBUG": "1",
      "SPEECH_DELTA_ONLY": "1",
      "SPEECH_DELTA_PERSIST": "1",
      "SPEECH_DELTA_TTL_MS": "86400000"
    },
    "expect": {
      "kind": "Spoke",
      "category": "confidence",
      "threadId": "tier15_delta_001"
    },
    "post_assert": {
      "stderr_contains": [
        "\"reason\":\"DELTA_NO_CHANGE\""
      ]
    }
  },
  {
    "name": "tier15-operator-policy-simulate-happy",
    "stage": "cli",
    "command": "/operator policy-simulate --policy speech_gate --confidence 0.2,0.9",
    "expect": {
      "kind": "PolicySimulation",
      "policy": "speech_gate",
      "results": [
        {
          "decision": "DENY",
          "reason": "LOW_CONFIDENCE",
          "confidence": 0.2,
          "spoken_explain": {
            "text": "Simulation: Denied (LOW_CONFIDENCE) at confidence 0.20",
            "category": "confidence",
            "confidence": 0.2
          }
        },
        {
          "decision": "ALLOW",
          "reason": null,
          "confidence": 0.9,
          "spoken_explain": {
            "text": "Simulation: Allowed at confidence 0.90",
            "category": "confidence",
            "confidence": 0.9
          }
        }
      ]
    }
  },
  {
    "name": "tier15-operator-policy-simulate-deny",
    "stage": "cli",
    "command": "/operator policy-simulate --policy speech_gate --confidence 0.1",
    "expect": {
      "kind": "PolicySimulation",
      "policy": "speech_gate",
      "results": [
        {
          "decision": "DENY",
          "reason": "LOW_CONFIDENCE",
          "confidence": 0.1,
          "spoken_explain": {
            "text": "Simulation: Denied (LOW_CONFIDENCE) at confidence 0.10",
            "category": "confidence",
            "confidence": 0.1
          }
        }
      ]
    }
  },
  {
    "name": "tier16-regression-suspends-fingerprint",
    "stage": "cli",
    "command": "/policy simulate-variants notion.write.page --confidence 0.2,0.9",
    "env": {
      "REQUALIFICATION_ENABLED": "1"
    },
    "expect_file_exists": "runs/requalification/state/notion.write.page.json",
    "expect": {
      "kind": "PolicySimulationVariants",
      "fingerprint": "notion.write.page",
      "regression": {
        "kind": "ConfidenceRegression",
        "at_confidence": 0.9
      }
    },
    "post_assert": {
      "artifact_dir": "runs/requalification/state",
      "contains_subset": {
        "fingerprint": "notion.write.page",
        "state": "SUSPENDED",
        "cause": "CONFIDENCE_REGRESSION"
      }
    }
  },
  {
    "name": "tier16-regression-visible-to-requalifier",
    "stage": "cli",
    "command": "/autonomy requalify scan",
    "env": {
      "REQUALIFICATION_ENABLED": "1"
    },
    "expect": {
      "kind": "RequalificationScan"
    },
    "post_assert": {
      "still_suspended[*]": "notion.write.page"
    }
  },
  {
    "name": "tier18-ranking-order",
    "stage": "cli",
    "command": "/operator queue",
    "expect": {
      "kind": "OperatorQueue"
    },
    "post_assert": {
      "jobs[0].regression.regressed": true,
      "jobs[1].policy_state.reason": "APPROVAL_REQUIRED"
    }
  },
  {
    "name": "speech-low-confidence-silenced",
    "stage": "cli",
    "env": {
      "SPEECH_ENABLED": "1",
      "SPEECH_SINKS": "console",
      "SPEECH_CATEGORIES": "confidence",
      "SPEECH_CONFIDENCE_GRADIENT": "1",
      "SPEECH_GRADIENT_PREFIX": "1",
      "SPEECH_VOICE_BUDGET": "2",
      "SPEECH_ARTIFACTS": "1",
      "THREAD_ID": "speech_001",
      "ALLOWED_DOMAINS": null,
      "ALLOWED_METHODS": null,
      "ENVIRONMENT": null,
      "NODE_ENV": null,
      "CONFIRM_PROD": null
    },
    "command": "/speak confidence 0.2 should not speak",
    "post_assert": {
      "artifact_dir": "runs/speech-decisions",
      "contains_subset": {
        "kind": "SpeechDecision",
        "category": "confidence",
        "decision": {
          "allow": false,
          "reason": "LOW_CONFIDENCE"
        }
      }
    }
  },
  {
    "name": "speech-confidence-recovers-speaks-once",
    "stage": "cli",
    "env": {
      "SPEECH_ENABLED": "1",
      "SPEECH_SINKS": "console",
      "SPEECH_CATEGORIES": "confidence",
      "SPEECH_CONFIDENCE_GRADIENT": "1",
      "SPEECH_GRADIENT_PREFIX": "1",
      "SPEECH_VOICE_BUDGET": "1",
      "SPEECH_ARTIFACTS": "1",
      "THREAD_ID": "speech_002",
      "ALLOWED_DOMAINS": null,
      "ALLOWED_METHODS": null,
      "ENVIRONMENT": null,
      "NODE_ENV": null,
      "CONFIRM_PROD": null
    },
    "command": "/speak confidence 0.85 one\n/speak confidence 0.85 two",
    "post_assert": {
      "artifact_dir": "runs/speech-decisions",
      "contains_subset": {
        "kind": "SpeechDecision",
        "category": "confidence",
        "decision": {
          "allow": false,
          "reason": "BUDGET_EXHAUSTED"
        }
      }
    }
  },
  {
    "name": "speech-rate-cap-denies-second",
    "stage": "cli",
    "env": {
      "SPEECH_ENABLED": "1",
      "SPEECH_SINKS": "console",
      "SPEECH_CATEGORIES": "confidence",
      "SPEECH_CONFIDENCE_GRADIENT": "1",
      "SPEECH_GRADIENT_PREFIX": "1",
      "SPEECH_VOICE_BUDGET": "10",
      "SPEECH_MAX_PER_MINUTE": "1",
      "SPEECH_ARTIFACTS": "1",
      "THREAD_ID": "speech_rate_001",
      "ALLOWED_DOMAINS": null,
      "ALLOWED_METHODS": null,
      "ENVIRONMENT": null,
      "NODE_ENV": null,
      "CONFIRM_PROD": null
    },
    "command": "/speak confidence 0.85 one\n/speak confidence 0.85 two",
    "post_assert": {
      "artifact_dir": "runs/speech-decisions",
      "contains_subset": {
        "kind": "SpeechDecision",
        "category": "confidence",
        "decision": {
          "allow": false,
          "reason": "RATE_LIMIT"
        }
      }
    }
  },
  {
    "name": "tier18-auto-runnable-visible",
    "stage": "cli",
    "command": "/operator queue",
    "expect": {
      "kind": "OperatorQueue"
    },
    "post_assert": {
      "jobs[*].confidence.action": "AUTO_RUN"
    }
  },
  {
    "name": "operator-speech-status-happy",
    "stage": "cli",
    "command": "/operator speech-status",
    "expect": {
      "kind": "OperatorSpeechStatus"
    },
    "post_assert": {
      "enabled": true,
      "sink": "console",
      "debug_enabled": false
    }
  },
  {
    "name": "operator-speech-check-json",
    "stage": "cli",
    "command": "/operator speech-check",
    "expect": {
      "kind": "OperatorSpeechCheck"
    },
    "post_assert": {
      "enabled": true,
      "sinks.requested_order[0]": "elevenlabs",
      "sinks.requested_order[1]": "os-tts",
      "sinks.requested_order[2]": "console",
      "sinks.configured_order[0]": "os-tts",
      "sinks.configured_order[1]": "console"
    }
  },
  {
    "name": "tier18-ui-queue-renders-ranked-jobs",
    "stage": "cli",
    "command": "/operator-ui queue",
    "expect": {
      "kind": "OperatorUiQueue"
    },
    "post_assert": {
      "rows[0].status": "REGRESSION",
      "rows[*].confidence": {
        "action": "AUTO_RUN"
      }
    }
  },
  {
    "name": "tier18-ui-approve-emits-receipt",
    "stage": "cli",
    "command": "/operator-ui approve tier18_ui_approval_001",
    "expect": {
      "kind": "OperatorUiActionResult",
      "action": "APPROVE",
      "execution_id": "tier18_ui_approval_001"
    },
    "post_assert": {
      "receipt_subset": {
        "status": "success",
        "execution_id": "tier18_ui_approval_001"
      }
    }
  },
  {
    "name": "tier20-delegated-class-autorun",
    "stage": "cli",
    "command": "/notion set pg_999 Status=Done",
    "precondition": {
      "delegated_class": "tier20-notion-status-updates-autorun"
    },
    "env": {
      "AUTONOMY_MODE": "APPROVAL_GATED_AUTONOMY",
      "ALLOWED_DOMAINS": null,
      "ALLOWED_METHODS": null,
      "NODE_ENV": null,
      "CONFIRM_PROD": null
    },
    "expect": {
      "executed": true,
      "approval_required": false
    }
  },
  {
    "name": "tier20-delegation-suspended-on-regression",
    "stage": "cli",
    "command": "/notion set pg_999 Status=Done",
    "precondition": {
      "delegated_class": "tier20-notion-status-updates-regression"
    },
    "env": {
      "AUTONOMY_MODE": "APPROVAL_GATED_AUTONOMY",
      "ALLOWED_DOMAINS": null,
      "ALLOWED_METHODS": null,
      "NODE_ENV": null,
      "CONFIRM_PROD": null
    },
    "expect": {
      "executed": false,
      "approval_required": true,
      "delegation_active": false,
      "reason": "CONFIDENCE_REGRESSION"
    }
  },
  {
    "name": "tier21-domain-overlay-deny-write",
    "stage": "cli",
    "command": "/domain ops.notion /notion set pg_999 Status=Done",
    "env": {
      "AUTONOMY_MODE": "OFF",
      "ALLOWED_DOMAINS": null,
      "ALLOWED_METHODS": null,
      "NODE_ENV": null,
      "CONFIRM_PROD": null
    },
    "expect_exit_code": 3,
    "expect": {
      "kind": "PolicyDenied",
      "code": "DOMAIN_OVERLAY_DENY_WRITE"
    }
  },
  {
    "name": "tier21-role-blocks-approval",
    "stage": "cli",
    "command": "/domain ops.notion /approve exec_write_001",
    "env": {
      "AUTONOMY_MODE": "OFF",
      "ALLOWED_DOMAINS": null,
      "ALLOWED_METHODS": null,
      "NODE_ENV": null,
      "CONFIRM_PROD": null
    },
    "expect_exit_code": 3,
    "expect": {
      "kind": "PolicyDenied",
      "code": "OPERATOR_NOT_AUTHORIZED_FOR_DOMAIN"
    }
  },
  {
    "name": "tier-infinity-token-exhausted",
    "stage": "cli",
    "command": "/intake ./docs",
    "env": {
      "RUN_GOVERNOR_ENABLED": "1",
      "AUTONOMY_TOKENS_PER_HOUR": "1",
      "AUTONOMY_MAX_CONCURRENT": "1",
      "SMOKE_FIXED_NOW_ISO": "2025-01-01T00:00:00.000Z",
      "AUTONOMY_MODE": "APPROVAL_GATED_AUTONOMY",
      "ALLOWED_DOMAINS": null,
      "ALLOWED_METHODS": null,
      "NODE_ENV": null,
      "CONFIRM_PROD": null
    },
    "precondition": {
      "governor_counter": {
        "fingerprint": "intake.scan",
        "hour_start": "2025-01-01T00:00:00.000Z",
        "tokens_remaining": 0,
        "concurrent": 0,
        "updated_at": "2025-01-01T00:00:00.000Z"
      }
    },
    "expect_exit_code": 3,
    "expect": {
      "kind": "Throttled",
      "reason": "TOKEN_EXHAUSTED",
      "retry_after": "2025-01-01T01:00:00.000Z"
    },
    "post_assert": {
      "no_writes": {
        "paths": [
          "runs/intake"
        ]
      },
      "receipt_subset": {
        "status": "throttled",
        "policy_code": "TOKEN_EXHAUSTED"
      }
    }
  },
  {
    "name": "tier-infinity-circuit-breaker-opens",
    "stage": "cli",
    "command": "/intake ./docs",
    "env": {
      "RUN_GOVERNOR_ENABLED": "1",
      "REQUALIFICATION_ENABLED": "1",
      "AUTONOMY_CB_ROLLBACKS": "1",
      "AUTONOMY_CB_OPEN_HOURS": "1",
      "SMOKE_FIXED_NOW_ISO": "2025-01-01T00:00:00.000Z",
      "AUTONOMY_MODE": "APPROVAL_GATED_AUTONOMY",
      "ALLOWED_DOMAINS": null,
      "ALLOWED_METHODS": null,
      "NODE_ENV": null,
      "CONFIRM_PROD": null
    },
    "precondition": {
      "rollback_artifacts": [
        {
          "kind": "RollbackArtifact",
          "fingerprint": "intake.scan",
          "at": "2025-01-01T00:00:00.000Z"
        }
      ]
    },
    "expect_exit_code": 3,
    "expect": {
      "kind": "Throttled",
      "reason": "CIRCUIT_OPEN",
      "retry_after": "2025-01-01T01:00:00.000Z"
    },
    "post_assert": {
      "receipt_subset": {
        "status": "throttled",
        "policy_code": "CIRCUIT_OPEN"
      },
      "artifact_dir": "runs/governor/circuit-breakers",
      "contains_keys": [
        "fingerprint",
        "opened_at",
        "open_until",
        "reason",
        "counts"
      ],
      "contains_subset": {
        "fingerprint": "intake.scan",
        "reason": "ROLLBACK_THRESHOLD"
      }
    }
  },
  {
    "name": "tier22-suspended-enters-probation",
    "stage": "cli",
    "command": "/autonomy requalify scan",
    "env": {
      "SMOKE_FIXED_NOW_ISO": "2025-01-01T00:00:00.000Z",
      "AUTONOMY_MODE": "OFF",
      "ALLOWED_DOMAINS": null,
      "ALLOWED_METHODS": null,
      "NODE_ENV": null,
      "CONFIRM_PROD": null
    },
    "precondition": {
      "requalification_state": {
        "fingerprint": "notion.write.page",
        "state": "SUSPENDED",
        "cause": "seeded",
        "since": "2025-01-01T00:00:00.000Z",
        "cooldown_until": "2025-01-01T00:00:00.000Z"
      }
    },
    "expect": {
      "kind": "RequalificationScan",
      "evaluated": 1,
      "eligible": [],
      "still_suspended": []
    },
    "post_assert": {
      "artifact_dir": "runs/requalification/state",
      "contains_keys": [
        "fingerprint",
        "state",
        "cause",
        "since",
        "cooldown_until"
      ],
      "contains_subset": {
        "fingerprint": "notion.write.page",
        "state": "PROBATION"
      }
    }
  },
  {
    "name": "tier22-probation-monotonic-success",
    "stage": "cli",
    "command": "/policy simulate-variants notion.write.page --confidence 0.6,0.7,0.8",
    "env": {
      "REQUALIFICATION_ENABLED": "1",
      "SMOKE_FIXED_NOW_ISO": "2025-01-01T00:00:00.000Z",
      "AUTONOMY_MODE": "OFF",
      "ALLOWED_DOMAINS": null,
      "ALLOWED_METHODS": null,
      "NODE_ENV": null,
      "CONFIRM_PROD": null
    },
    "precondition": {
      "requalification_state": {
        "fingerprint": "notion.write.page",
        "state": "PROBATION",
        "cause": "seeded",
        "since": "2025-01-01T00:00:00.000Z",
        "cooldown_until": null
      }
    },
    "expect": {
      "kind": "PolicySimulationVariants",
      "fingerprint": "notion.write.page"
    },
    "expect_file_exists": "runs/requalification/events/notion.write.page.1735689600003.json",
    "post_assert": {
      "artifact_dir": "runs/requalification/state",
      "contains_subset": {
        "fingerprint": "notion.write.page",
        "state": "ELIGIBLE",
        "cause": "PROBATION_SUCCESS_THRESHOLD",
        "success_count": 3,
        "required": 3
      }
    }
  },
  {
    "name": "tier22-cooldown-auto-probation",
    "stage": "cli",
    "command": "/autonomy requalify scan",
    "env": {
      "REQUALIFICATION_ENABLED": "1",
      "SMOKE_FIXED_NOW_ISO": "2025-01-02T00:00:00.000Z",
      "AUTONOMY_MODE": "OFF",
      "ALLOWED_DOMAINS": null,
      "ALLOWED_METHODS": null,
      "NODE_ENV": null,
      "CONFIRM_PROD": null
    },
    "precondition": {
      "requalification_state": {
        "fingerprint": "notion.write.page",
        "state": "SUSPENDED",
        "cause": "seeded",
        "since": "2025-01-01T00:00:00.000Z",
        "cooldown_until": "2025-01-01T00:00:00.000Z"
      }
    },
    "expect": {
      "kind": "RequalificationScan"
    },
    "expect_file_exists": "runs/requalification/events/notion.write.page.1735776000000.json",
    "post_assert": {
      "artifact_dir": "runs/requalification/state",
      "contains_keys": [
        "fingerprint",
        "state",
        "cause",
        "since",
        "cooldown_until"
      ],
      "contains_subset": {
        "fingerprint": "notion.write.page",
        "state": "PROBATION",
        "cause": "COOLDOWN_ELAPSED"
      },
      "receipt_subset": {
        "execution_id": "autonomy_transition_notion-write-page_1735776000000",
        "kind": "AutonomyStateTransition",
        "fingerprint": "notion.write.page"
      }
    }
  },
  {
    "name": "tier22-probation-regression-resets",
    "stage": "cli",
    "command": "/policy simulate-variants notion.write.page --confidence 0.7,0.8,0.75",
    "env": {
      "REQUALIFICATION_ENABLED": "1",
      "SMOKE_FIXED_NOW_ISO": "2025-01-01T00:00:00.000Z",
      "AUTONOMY_MODE": "OFF",
      "ALLOWED_DOMAINS": null,
      "ALLOWED_METHODS": null,
      "NODE_ENV": null,
      "CONFIRM_PROD": null
    },
    "precondition": {
      "requalification_state": {
        "fingerprint": "notion.write.page",
        "state": "PROBATION",
        "cause": "seeded",
        "since": "2025-01-01T00:00:00.000Z",
        "cooldown_until": null
      }
    },
    "expect": {
      "kind": "PolicySimulationVariants",
      "fingerprint": "notion.write.page"
    },
    "expect_file_exists": "runs/requalification/events/notion.write.page.1735689600002.json",
    "post_assert": {
      "artifact_dir": "runs/requalification/state",
      "contains_subset": {
        "fingerprint": "notion.write.page",
        "state": "PROBATION",
        "success_count": 0,
        "required": 3
      }
    }
  },
  {
    "name": "tier18-confidence-view-monotonic-success",
    "stage": "cli",
    "command": "/operator confidence-view notion.write.page",
    "env": {
      "REQUALIFICATION_ENABLED": "1",
      "SMOKE_FIXED_NOW_ISO": "2025-01-01T00:00:00.000Z",
      "AUTONOMY_MODE": "OFF",
      "ALLOWED_DOMAINS": null,
      "ALLOWED_METHODS": null,
      "NODE_ENV": null,
      "CONFIRM_PROD": null
    },
    "precondition": {
      "requalification_state": {
        "fingerprint": "notion.write.page",
        "state": "PROBATION",
        "cause": "seeded",
        "since": "2025-01-01T00:00:00.000Z",
        "cooldown_until": null
      },
      "requalification_events": [
        {
          "kind": "ProbationSuccess",
          "fingerprint": "notion.write.page",
          "at": "2025-01-01T00:00:00.001Z",
          "confidence": 0.7,
          "decision": "ALLOW",
          "success_count": 1,
          "required_successes": 3
        },
        {
          "kind": "ProbationSuccess",
          "fingerprint": "notion.write.page",
          "at": "2025-01-01T00:00:00.002Z",
          "confidence": 0.8,
          "decision": "ALLOW",
          "success_count": 2,
          "required_successes": 3
        },
        {
          "kind": "ProbationSuccess",
          "fingerprint": "notion.write.page",
          "at": "2025-01-01T00:00:00.003Z",
          "confidence": 0.85,
          "decision": "ALLOW",
          "success_count": 3,
          "required_successes": 3
        },
        {
          "kind": "RequalificationRecommended",
          "fingerprint": "notion.write.page",
          "at": "2025-01-01T00:00:00.004Z",
          "recommendation": "ELIGIBLE"
        }
      ]
    },
    "expect": {
      "kind": "OperatorConfidenceView",
      "fingerprint": "notion.write.page",
      "rows": [
        {
          "confidence": 0.7,
          "decision": "ALLOW",
          "success": "1/3",
          "monotonic": true
        },
        {
          "confidence": 0.8,
          "decision": "ALLOW",
          "success": "2/3",
          "monotonic": true
        },
        {
          "confidence": 0.85,
          "decision": "ALLOW",
          "success": "3/3",
          "monotonic": true
        }
      ]
    }
  },
  {
    "name": "tier18-confidence-view-regression-resets",
    "stage": "cli",
    "command": "/operator confidence-view notion.write.page",
    "env": {
      "REQUALIFICATION_ENABLED": "1",
      "SMOKE_FIXED_NOW_ISO": "2025-01-01T00:00:00.000Z",
      "AUTONOMY_MODE": "OFF",
      "ALLOWED_DOMAINS": null,
      "ALLOWED_METHODS": null,
      "NODE_ENV": null,
      "CONFIRM_PROD": null
    },
    "precondition": {
      "requalification_state": {
        "fingerprint": "notion.write.page",
        "state": "PROBATION",
        "cause": "seeded",
        "since": "2025-01-01T00:00:00.000Z",
        "cooldown_until": null
      },
      "requalification_events": [
        {
          "kind": "ProbationSuccess",
          "fingerprint": "notion.write.page",
          "at": "2025-01-01T00:00:00.001Z",
          "confidence": 0.8,
          "decision": "ALLOW",
          "success_count": 1,
          "required_successes": 3
        },
        {
          "kind": "ProbationSuccess",
          "fingerprint": "notion.write.page",
          "at": "2025-01-01T00:00:00.002Z",
          "confidence": 0.75,
          "last_confidence": 0.8,
          "decision": "ALLOW",
          "success_count": 0,
          "required_successes": 3
        }
      ]
    },
    "expect": {
      "kind": "OperatorConfidenceView",
      "fingerprint": "notion.write.page",
      "rows": [
        {
          "confidence": 0.8,
          "decision": "ALLOW",
          "success": "1/3",
          "monotonic": true
        },
        {
          "confidence": 0.75,
          "decision": "ALLOW",
          "success": "0/3",
          "monotonic": false
        }
      ]
    }
  },
  {
    "name": "operator-confidence-curve-happy",
    "stage": "cli",
    "command": "/operator confidence-curve test_fingerprint",
    "env": {
      "REQUALIFICATION_ENABLED": "1",
      "SMOKE_FIXED_NOW_ISO": "2025-01-01T00:00:00.000Z",
      "AUTONOMY_MODE": "OFF",
      "ALLOWED_DOMAINS": null,
      "ALLOWED_METHODS": null,
      "NODE_ENV": null,
      "CONFIRM_PROD": null
    },
    "expect": {
      "kind": "OperatorView"
    }
  },
  {
    "name": "tier16-autonomy-requalify-recommends-eligible",
    "stage": "cli",
    "command": "/autonomy requalify scan",
    "env": {
      "REQUALIFICATION_ENABLED": "1",
      "SMOKE_FIXED_NOW_ISO": "2025-01-01T00:00:00.000Z",
      "AUTONOMY_MODE": "OFF",
      "ALLOWED_DOMAINS": null,
      "ALLOWED_METHODS": null,
      "NODE_ENV": null,
      "CONFIRM_PROD": null
    },
    "precondition": {
      "requalification_state": {
        "fingerprint": "notion.write.page",
        "state": "ELIGIBLE",
        "cause": "PROBATION_SUCCESS_THRESHOLD",
        "since": "2025-01-01T00:00:00.000Z",
        "cooldown_until": null,
        "success_count": 3,
        "required_successes": 3
      }
    },
    "expect": {
      "kind": "RequalificationScan",
      "eligible": [
        "notion.write.page"
      ],
      "recommended": [
        "notion.write.page"
      ]
    },
    "post_assert": {
      "receipt_subset": {
        "kind": "RequalificationRecommended",
        "execution_id": "requal_recommended_notion-write-page_1735689600001",
        "fingerprint": "notion.write.page",
        "status": "success"
      }
    }
  },
  {
    "name": "tier16-autonomy-requalify-does-not-recommend-probation",
    "stage": "cli",
    "command": "/autonomy requalify scan",
    "env": {
      "REQUALIFICATION_ENABLED": "1",
      "SMOKE_FIXED_NOW_ISO": "2025-01-01T00:00:00.000Z",
      "AUTONOMY_MODE": "OFF",
      "ALLOWED_DOMAINS": null,
      "ALLOWED_METHODS": null,
      "NODE_ENV": null,
      "CONFIRM_PROD": null
    },
    "precondition": {
      "requalification_state": {
        "fingerprint": "notion.write.page",
        "state": "PROBATION",
        "cause": "seeded",
        "since": "2025-01-01T00:00:00.000Z",
        "cooldown_until": null,
        "success_count": 2,
        "required_successes": 3,
        "last_confidence": 0.8
      }
    },
    "expect": {
      "kind": "RequalificationScan",
      "eligible": [],
      "recommended": []
    }
  },
  {
    "name": "tier22-no-auto-activation",
    "stage": "cli",
    "command": "/notion live db db_001",
    "env": {
      "REQUALIFICATION_ENABLED": "1",
      "PROBATION_SUCCESS_REQUIRED": "3",
      "SMOKE_FIXED_NOW_ISO": "2025-01-02T00:00:00.000Z",
      "AUTONOMY_MODE": "OFF",
      "ALLOWED_DOMAINS": null,
      "ALLOWED_METHODS": null,
      "NODE_ENV": null,
      "CONFIRM_PROD": null,
      "NOTION_API_BASE": "http://localhost:8787",
      "NOTION_API_VERSION": "2022-06-28",
      "NOTION_TOKEN": "local_mock_token",
      "NOTION_REDACT_KEYS": "title,name"
    },
    "precondition": {
      "requalification_state": {
        "fingerprint": "notion.write.page",
        "state": "ELIGIBLE",
        "cause": "seeded",
        "since": "2025-01-02T00:00:00.000Z",
        "cooldown_until": null
      }
    },
    "expect": {
      "status": "success"
    },
    "post_assert": {
      "artifact_dir": "runs/requalification/state",
      "contains_subset": {
        "fingerprint": "notion.write.page",
        "state": "ELIGIBLE"
      }
    }
  },
  {
    "name": "tier22-activate-eligible",
    "stage": "cli",
    "command": "/autonomy requalify activate notion.write.page",
    "env": {
      "REQUALIFICATION_ENABLED": "1",
      "SMOKE_FIXED_NOW_ISO": "2025-01-02T00:00:00.000Z",
      "AUTONOMY_MODE": "OFF",
      "ALLOWED_DOMAINS": null,
      "ALLOWED_METHODS": null,
      "NODE_ENV": null,
      "CONFIRM_PROD": null
    },
    "precondition": {
      "requalification_state": {
        "fingerprint": "notion.write.page",
        "state": "ELIGIBLE",
        "cause": "seeded",
        "since": "2025-01-02T00:00:00.000Z",
        "cooldown_until": null
      }
    },
    "expect": {
      "kind": "ActivationApproved",
      "state": "ACTIVE"
    }
  },
  {
    "name": "tier22-activate-denied-not-eligible",
    "stage": "cli",
    "command": "/autonomy requalify activate tax.write.estimate",
    "env": {
      "REQUALIFICATION_ENABLED": "1",
      "SMOKE_FIXED_NOW_ISO": "2025-01-02T00:00:00.000Z",
      "AUTONOMY_MODE": "OFF",
      "ALLOWED_DOMAINS": null,
      "ALLOWED_METHODS": null,
      "NODE_ENV": null,
      "CONFIRM_PROD": null
    },
    "expect": {
      "kind": "ActivationDenied",
      "reason": "NOT_ELIGIBLE"
    },
    "expect_exit_code": 3
  },
  {
    "name": "tier-infinity-activation-token-exhausted",
    "stage": "cli",
    "repeat": 2,
    "command": "/autonomy requalify activate notion.write.page",
    "env": {
      "REQUALIFICATION_ENABLED": "1",
      "SMOKE_FIXED_NOW_ISO": "2025-01-02T00:00:00.000Z",
      "ACTIVATE_TOKENS_PER_HOUR": "1",
      "ACTIVATE_MAX_CONCURRENT": "1",
      "AUTONOMY_MODE": "OFF",
      "ALLOWED_DOMAINS": null,
      "ALLOWED_METHODS": null,
      "NODE_ENV": null,
      "CONFIRM_PROD": null
    },
    "precondition": {
      "requalification_state": {
        "fingerprint": "notion.write.page",
        "state": "ELIGIBLE",
        "cause": "seeded",
        "since": "2025-01-02T00:00:00.000Z",
        "cooldown_until": null
      }
    },
    "expect": {
      "kind": "Throttled",
      "scope": "activation",
      "reason": "TOKEN_EXHAUSTED"
    },
    "expect_exit_code": 3
  },
  {
    "name": "tier-infinity-activation-circuit-open",
    "stage": "cli",
    "command": "/autonomy requalify activate notion.write.page",
    "env": {
      "REQUALIFICATION_ENABLED": "1",
      "SMOKE_FIXED_NOW_ISO": "2025-01-02T00:00:00.000Z",
      "ACTIVATE_TOKENS_PER_HOUR": "1",
      "ACTIVATE_MAX_CONCURRENT": "1",
      "AUTONOMY_MODE": "OFF",
      "ALLOWED_DOMAINS": null,
      "ALLOWED_METHODS": null,
      "NODE_ENV": null,
      "CONFIRM_PROD": null
    },
    "precondition": {
      "requalification_state": {
        "fingerprint": "notion.write.page",
        "state": "ELIGIBLE",
        "cause": "seeded",
        "since": "2025-01-02T00:00:00.000Z",
        "cooldown_until": null
      }
    },
    "inject": {
      "circuit_open": true,
      "fingerprint": "autonomy.activate"
    },
    "expect": {
      "kind": "Throttled",
      "scope": "activation",
      "reason": "CIRCUIT_OPEN"
    },
    "expect_exit_code": 3
  },
  {
    "name": "tier-infinity-requalify-token-exhausted",
    "stage": "cli",
    "command": "/autonomy requalify scan",
    "repeat": 3,
    "env": {
      "SMOKE_FIXED_NOW_ISO": "2025-01-01T00:00:00.000Z",
      "REQUALIFY_TOKENS_PER_HOUR": "2",
      "REQUALIFY_MAX_CONCURRENT": "1",
      "AUTONOMY_MODE": "OFF",
      "ALLOWED_DOMAINS": null,
      "ALLOWED_METHODS": null,
      "NODE_ENV": null,
      "CONFIRM_PROD": null
    },
    "expect": {
      "kind": "Throttled",
      "reason": "TOKEN_EXHAUSTED"
    },
    "expect_exit_code": 3
  },
  {
    "name": "tier-infinity-requalify-circuit-open",
    "stage": "cli",
    "command": "/autonomy requalify scan",
    "env": {
      "SMOKE_FIXED_NOW_ISO": "2025-01-01T00:00:00.000Z",
      "REQUALIFY_TOKENS_PER_HOUR": "2",
      "REQUALIFY_MAX_CONCURRENT": "1",
      "AUTONOMY_MODE": "OFF",
      "ALLOWED_DOMAINS": null,
      "ALLOWED_METHODS": null,
      "NODE_ENV": null,
      "CONFIRM_PROD": null
    },
    "inject": {
      "circuit_open": true,
      "fingerprint": "autonomy.requalify"
    },
    "expect": {
      "kind": "Throttled",
      "reason": "CIRCUIT_OPEN"
    },
    "expect_exit_code": 3
  },
  {
    "name": "tier29-approval-required-notify",
    "stage": "cli",
    "fixture_write": [
      {
        "path": "playbooks/registry.json",
        "json": [
          {
            "id": "approval_required_notify",
            "enabled": true,
            "when": { "kind": "ApprovalRequired" },
            "conditions": {
              "domain": ["notion"]
            },
            "actions": [
              { "type": "notify", "channel": "operator", "template": "approval_needed" }
            ]
          }
        ]
      }
    ],
    "env": {
      "PLAYBOOKS_ENABLED": "1",
      "ALLOWED_DOMAINS": null,
      "ALLOWED_METHODS": null,
      "ENVIRONMENT": null,
      "NODE_ENV": null,
      "CONFIRM_PROD": null
    },
    "command": "/notion set pg_001 Status=Done",
    "expect_exit_code": 4,
    "expect": {
      "kind": "ApprovalRequired",
      "code": "NOTION_WRITE_APPROVAL_REQUIRED"
    },
    "post_assert": {
      "approval_state": true,
      "files_exist": [
        "runs/playbooks/exec_mock_notion_write_001.approval_required_notify.json"
      ],
      "receipt_subset": {
        "kind": "PlaybookExecuted",
        "playbook_id": "approval_required_notify",
        "parent_execution_id": "exec_mock_notion_write_001"
      }
    }
  },
  {
    "name": "tier29-playbook-budget-exhausted",
    "stage": "cli",
    "repeat": 2,
    "fixture_write": [
      {
        "path": "playbooks/registry.json",
        "json": [
          {
            "id": "approval_required_notify",
            "enabled": true,
            "when": { "kind": "ApprovalRequired" },
            "conditions": {
              "domain": ["notion"]
            },
            "actions": [
              { "type": "notify", "channel": "operator", "template": "approval_needed" }
            ]
          }
        ]
      }
    ],
    "env": {
      "PLAYBOOKS_ENABLED": "1",
      "AUTONOMY_TOKENS_PER_HOUR": "1",
      "AUTONOMY_MAX_CONCURRENT": "1",
      "ALLOWED_DOMAINS": null,
      "ALLOWED_METHODS": null,
      "ENVIRONMENT": null,
      "NODE_ENV": null,
      "CONFIRM_PROD": null
    },
    "command": "/notion set pg_001 Status=Done",
    "expect_exit_code": 4,
    "expect": {
      "kind": "ApprovalRequired",
      "code": "NOTION_WRITE_APPROVAL_REQUIRED"
    },
    "post_assert": {
      "approval_state": true,
      "artifact_dir": "runs/playbooks",
      "contains_subset": {
        "playbook_id": "approval_required_notify",
        "throttled": true
      },
      "receipt_subset": {
        "kind": "Throttled",
        "throttle_reason": "PLAYBOOK_BUDGET_EXHAUSTED",
        "playbook_id": "approval_required_notify",
        "parent_execution_id": "exec_mock_notion_write_001"
      }
    }
  },
  {
    "name": "tier17-operator-rank-writes-artifact",
    "stage": "cli",
    "env": {
      "SMOKE_FIXED_NOW_ISO": "2025-12-26T00:00:00Z"
    },
    "command": "/operator rank 7",
    "expect_subset": {
      "kind": "OperatorRanking",
      "window_days": 7
    },
    "post_assert": {
      "artifact_dir": "runs/operator/rankings",
      "contains_keys": [
        "score",
        "totals"
      ]
    }
  },
  {
    "name": "tier17-operator-rank-deterministic-shape",
    "stage": "cli",
    "env": {
      "SMOKE_FIXED_NOW_ISO": "2025-12-26T00:00:00Z"
    },
    "command": "/operator rank 1",
    "expect_subset": {
      "kind": "OperatorRanking",
      "window_days": 1,
      "score": null,
      "breakdown": null,
      "totals": null
    }
  },
  {
    "name": "tier19-promotion-recommend-outputs-json",
    "stage": "cli",
    "command": "/autonomy promote recommend {\"windowRuns\":1,\"minAvgScore\":85,\"minAgeDays\":0}",
    "expect_subset": {
      "kind": "PromotionCandidatesRecommended"
    },
    "post_assert": {
      "artifact_dir": "runs/autonomy-promotion-candidates",
      "contains_keys": [
        "kind",
        "candidates"
      ]
    }
  },
  {
    "name": "tier19-promotion-recommend-writes-artifact",
    "stage": "cli",
    "command": "/autonomy promote recommend",
    "expect_subset": {
      "kind": "PromotionCandidatesRecommended"
    },
    "post_assert": {
      "artifact_dir": "runs/autonomy-promotion-candidates",
      "contains_keys": [
        "kind",
        "window_runs",
        "min_avg_score",
        "min_age_days",
        "candidates"
      ]
    }
  },
  {
    "name": "tier16-confidence-decays-on-policy-denial",
    "stage": "cli",
    "command": "/notion live write db_001",
    "env": {
      "ALLOWED_DOMAINS": null,
      "ALLOWED_METHODS": null,
      "ENVIRONMENT": null,
      "NODE_ENV": null,
      "CONFIRM_PROD": null,
      "NOTION_API_BASE": "http://localhost:8787",
      "NOTION_API_VERSION": "2022-06-28",
      "NOTION_TOKEN": "local_mock_token",
      "NOTION_REDACT_KEYS": "title,name"
    },
    "expect_exit_code": 3,
    "expect": {
      "kind": "PolicyDenied",
      "code": "NOTION_LIVE_REQUIRES_READ_ONLY"
    },
    "expect_file_exists": "runs/confidence/notion.write.page.json",
    "post_assert": {
      "artifact_dir": "runs/confidence",
      "contains_subset": {
        "fingerprint": "notion.write.page",
        "confidence": 0.8
      }
    }
  },
  {
    "name": "tier16-confidence-suspends-and-denies-next-run-preplanning",
    "stage": "cli",
    "repeat": 5,
    "command": "/notion live write db_001",
    "env": {
      "REQUALIFICATION_ENABLED": "1",
      "ALLOWED_DOMAINS": null,
      "ALLOWED_METHODS": null,
      "ENVIRONMENT": null,
      "NODE_ENV": null,
      "CONFIRM_PROD": null,
      "NOTION_API_BASE": "http://localhost:8787",
      "NOTION_API_VERSION": "2022-06-28",
      "NOTION_TOKEN": "local_mock_token",
      "NOTION_REDACT_KEYS": "title,name"
    },
    "expect_exit_code": 3,
    "expect": {
      "kind": "PolicyDenied",
      "code": "REQUALIFICATION_BLOCKED"
    },
    "expect_file_exists": "runs/requalification/state/notion.write.page.json",
    "post_assert": {
      "artifact_dir": "runs/requalification/state",
      "contains_subset": {
        "fingerprint": "notion.write.page",
        "state": "SUSPENDED",
        "cause": "CONFIDENCE_TOO_LOW"
      }
    }
  },
  {
    "name": "operator-repo-status-happy",
    "stage": "cli",
    "command": "/operator repo-status",
    "expect": {
      "kind": "RepoStatus"
    }
  },
  {
    "name": "operator-repo-status-non-canonical",
    "stage": "cli",
    "env": {
      "CANONICAL_REPO_ROOT": "C:\\this\\path\\does\\not\\match"
    },
    "command": "/operator repo-status",
    "expect": {
      "kind": "RepoStatus",
      "non_canonical": true
    }
  },
  {
    "name": "Tier-S3: delta speaks + writes artifact",
    "command": "/status",
    "env": {
      "SMOKE_FIXED_NOW_ISO": "2030-01-01T00:00:00.000Z",
      "SPEECH_TIER": "S3"
    },
    "fixture_write": [
      {
        "path": "runs/receipts.jsonl",
        "content": "{\"ts\":\"2029-12-31T00:00:00.000Z\",\"fingerprint\":\"smoke-speech\",\"command\":\"/status\",\"ok\":true,\"autonomy_mode\":\"ON\",\"autonomy_mode_effective\":\"ON\",\"confidence\":{\"raw\":0.11,\"effective\":0.11},\"governor\":{\"throttle\":false},\"requalification\":{\"state\":\"CLEAR\"}}\n"
      }
    ],
    "post_assert": {
      "stderr_contains": ["[S3]"],
      "file_exists": ["runs/speech-deltas"]
    }
  },
  {
    "name": "Tier-S3: no prior -> no delta speech",
    "command": "/status",
    "env": {
      "SMOKE_FIXED_NOW_ISO": "2030-01-01T00:00:00.000Z",
      "SPEECH_TIER": "S3"
    },
    "fixture_write": [
      {
        "path": "runs/receipts.jsonl",
        "content": ""
      }
    ],
    "post_assert": {
      "stderr_not_contains": ["[S3]"],
      "file_not_exists": ["runs/speech-deltas"]
    }
  },
  {
    "name": "Tier-S5: autonomy on -> status speaks + writes artifact",
    "command": "/status",
    "env": {
      "SMOKE_FIXED_NOW_ISO": "2030-01-01T00:00:00.000Z",
      "SPEECH_TIER": "S5"
    },
    "fixture_write": [
      {
        "path": "runs/receipts.jsonl",
        "content": ""
      }
    ],
    "post_assert": {
      "stderr_contains": ["[S5]"],
      "file_exists": ["runs/speech-status"]
    }
  },
  {
    "name": "Tier-S5: autonomy off -> silent",
    "command": "/status",
    "env": {
      "SMOKE_FIXED_NOW_ISO": "2030-01-01T00:00:00.000Z",
      "SPEECH_TIER": "S5",
      "AUTONOMY_MODE_EFFECTIVE": "OFF"
    },
    "fixture_write": [
      {
        "path": "runs/receipts.jsonl",
        "content": ""
      }
    ],
    "post_assert": {
      "stderr_not_contains": ["[S5]"],
      "file_not_exists": ["runs/speech-status"]
    }
  },
  {
    "name": "tier22-probation-counter-increments",
    "stage": "cli",
    "cmd": "/autonomy requalify scan",
    "env": {
      "PROBATION_SUCCESS_WINDOW": "3"
    },
    "post_assert": {
      "requalification_counter": {
        "fingerprint": "notion.write.page",
        "min_successes": 1
      }
    }
  },
  {
    "name": "tier22-probation-recommends-eligible-after-window",
    "stage": "cli",
    "cmd": "/autonomy requalify scan",
    "env": {
      "PROBATION_SUCCESS_WINDOW": "2"
    },
    "post_assert": {
      "requalification_state": {
        "fingerprint": "notion.write.page",
        "state": "ELIGIBLE"
      }
    }
  }
]
